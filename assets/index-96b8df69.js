import{c as xe,r as _,u as ue,R as P,B as me,a as he,j as e,G as v,b as N,T as j,d as fe,e as ge,f as je,g as ve,h as ye,i as K,k as be,l as Se,m as E,n as O,P as R,o as L,p as M,A as I,q as Z,s as Le,t as Ce,v as we,w as Pe,x as B,y as F,M as Oe,L as _e,z as Me,O as De,C as W,D as V,E as Te,F as Re,H,I as Ie,J as k,K as ke,N as ze}from"./index-6323b734.js";import{u as ee,z as te,e as C,N as se,m as w,d as Ye,a as $e,b as re}from"./index-71096997.js";import{S as Ae,L as Ee}from"./ListManager-7e7e8bb0.js";import{u as U,L as Fe}from"./useCollectionDataPersistent-9a4142dc.js";import{L as z}from"./LabeledSegmentedControl-ff9d63e4.js";import{M as Ne,d as g}from"./dayjs.min-88875ddc.js";var Be=Object.defineProperty,We=Object.defineProperties,Ve=Object.getOwnPropertyDescriptors,q=Object.getOwnPropertySymbols,He=Object.prototype.hasOwnProperty,Ue=Object.prototype.propertyIsEnumerable,G=(t,r,s)=>r in t?Be(t,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[r]=s,Y=(t,r)=>{for(var s in r||(r={}))He.call(r,s)&&G(t,s,r[s]);if(q)for(var s of q(r))Ue.call(r,s)&&G(t,s,r[s]);return t},qe=(t,r)=>We(t,Ve(r));const $={xs:{fontSize:9,height:16},sm:{fontSize:10,height:18},md:{fontSize:11,height:20},lg:{fontSize:13,height:26},xl:{fontSize:16,height:32}},Ge={xs:4,sm:4,md:6,lg:8,xl:10};function Qe({theme:t,variant:r,color:s,size:n,gradient:o}){if(r==="dot"){const l=t.fn.size({size:n,sizes:Ge});return{backgroundColor:"transparent",color:t.colorScheme==="dark"?t.colors.dark[0]:t.colors.gray[7],border:`1px solid ${t.colorScheme==="dark"?t.colors.dark[3]:t.colors.gray[3]}`,paddingLeft:t.fn.size({size:n,sizes:t.spacing})/1.5-l/2,"&::before":{content:'""',display:"block",width:l,height:l,borderRadius:l,backgroundColor:t.fn.themeColor(s,t.colorScheme==="dark"?4:t.fn.primaryShade("light"),!0),marginRight:l}}}const i=t.fn.variant({color:s,variant:r,gradient:o});return{background:i.background,color:i.color,border:`${r==="gradient"?0:1}px solid ${i.border}`}}var Xe=xe((t,{color:r,size:s,radius:n,gradient:o,fullWidth:i,variant:l})=>{const{fontSize:a,height:d}=s in $?$[s]:$.md;return{leftSection:{marginRight:`calc(${t.spacing.xs}px / 2)`},rightSection:{marginLeft:`calc(${t.spacing.xs}px / 2)`},inner:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},root:Y(qe(Y(Y({},t.fn.focusStyles()),t.fn.fontStyles()),{fontSize:a,height:d,WebkitTapHighlightColor:"transparent",lineHeight:`${d-2}px`,textDecoration:"none",padding:`0 ${t.fn.size({size:s,sizes:t.spacing})/1.5}px`,boxSizing:"border-box",display:i?"flex":"inline-flex",alignItems:"center",justifyContent:"center",width:i?"100%":"auto",textTransform:"uppercase",borderRadius:t.fn.radius(n),fontWeight:700,letterSpacing:.25,cursor:"inherit",textOverflow:"ellipsis",overflow:"hidden"}),Qe({theme:t,variant:l,color:r,size:s,gradient:o}))}});const Je=Xe;var Ke=Object.defineProperty,D=Object.getOwnPropertySymbols,ne=Object.prototype.hasOwnProperty,oe=Object.prototype.propertyIsEnumerable,Q=(t,r,s)=>r in t?Ke(t,r,{enumerable:!0,configurable:!0,writable:!0,value:s}):t[r]=s,Ze=(t,r)=>{for(var s in r||(r={}))ne.call(r,s)&&Q(t,s,r[s]);if(D)for(var s of D(r))oe.call(r,s)&&Q(t,s,r[s]);return t},et=(t,r)=>{var s={};for(var n in t)ne.call(t,n)&&r.indexOf(n)<0&&(s[n]=t[n]);if(t!=null&&D)for(var n of D(t))r.indexOf(n)<0&&oe.call(t,n)&&(s[n]=t[n]);return s};const tt={variant:"light",size:"md",radius:"xl"},ie=_.exports.forwardRef((t,r)=>{const s=ue("Badge",tt,t),{className:n,color:o,variant:i,fullWidth:l,children:a,size:d,leftSection:c,rightSection:m,radius:p,gradient:x,classNames:f,styles:u,unstyled:y}=s,S=et(s,["className","color","variant","fullWidth","children","size","leftSection","rightSection","radius","gradient","classNames","styles","unstyled"]),{classes:h,cx:b}=Je({size:d,fullWidth:l,color:o,radius:p,variant:i,gradient:x},{classNames:f,styles:u,name:"Badge",unstyled:y});return P.createElement(me,Ze({className:b(h.root,n),ref:r},S),c&&P.createElement("span",{className:h.leftSection},c),P.createElement("span",{className:h.inner},a),m&&P.createElement("span",{className:h.rightSection},m))});ie.displayName="@mantine/core/Badge";const st=he(ie);function rt({clients:t,filters:r,updateFilter:s}){return e.exports.jsxs(e.exports.Fragment,{children:[e.exports.jsx(z,{label:"Status",data:[{label:"All",value:"all"},{label:"Pending",value:"pending"},{label:"Finished",value:"finished"},{label:"Delivered",value:"delivered"}],value:r.status,onChange:n=>s({status:n})}),e.exports.jsx(z,{label:"Order by",data:[{label:e.exports.jsxs(v,{spacing:"xs",position:"center",noWrap:!0,children:[e.exports.jsx(N,{}),e.exports.jsx(j,{children:"Price"})]}),value:"price"},{label:e.exports.jsxs(v,{spacing:"xs",position:"center",noWrap:!0,children:[e.exports.jsx(fe,{}),e.exports.jsx(j,{children:"Received"})]}),value:"receivedTimestamp"},{label:e.exports.jsxs(v,{spacing:"xs",position:"center",noWrap:!0,children:[e.exports.jsx(ge,{}),e.exports.jsx(j,{children:"Delivered"})]}),value:"deliveredTimestamp"}],value:r.orderBy,onChange:n=>s({orderBy:n})}),e.exports.jsx(z,{label:"Direction",data:[{label:e.exports.jsxs(v,{spacing:"xs",position:"center",noWrap:!0,children:[e.exports.jsx(je,{}),e.exports.jsx(j,{children:"Ascending"})]}),value:"asc"},{label:e.exports.jsxs(v,{spacing:"xs",position:"center",noWrap:!0,children:[e.exports.jsx(ve,{}),e.exports.jsx(j,{children:"Descending"})]}),value:"desc"}],value:r.direction,onChange:n=>s({direction:n})}),e.exports.jsx(Ne,{label:"Filter by clients",data:(t==null?void 0:t.map(n=>({value:n.id,label:n.name})))??[],icon:e.exports.jsx(ye,{}),placeholder:"Select clients",nothingFound:"Client not found",maxLength:36,searchable:!0,value:r.clients,onChange:n=>s({clients:n})})]})}var ae={exports:{}};(function(t,r){(function(s,n){t.exports=n()})(K,function(){return function(s,n,o){var i="h:mm A",l={lastDay:"[Yesterday at] "+i,sameDay:"[Today at] "+i,nextDay:"[Tomorrow at] "+i,nextWeek:"dddd [at] "+i,lastWeek:"[Last] dddd [at] "+i,sameElse:"MM/DD/YYYY"};n.prototype.calendar=function(a,d){var c=d||this.$locale().calendar||l,m=o(a||void 0).startOf("d"),p=this.diff(m,"d",!0),x="sameElse",f=p<-6?x:p<-1?"lastWeek":p<0?"lastDay":p<1?"sameDay":p<2?"nextDay":p<7?"nextWeek":x,u=c[f]||l[f];return typeof u=="function"?u.call(this,o()):this.format(u)}}})})(ae);const nt=ae.exports;var le={exports:{}};(function(t,r){(function(s,n){t.exports=n()})(K,function(){var s={LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"};return function(n,o,i){var l=o.prototype,a=l.format;i.en.formats=s,l.format=function(d){d===void 0&&(d="YYYY-MM-DDTHH:mm:ssZ");var c=this.$locale().formats,m=function(p,x){return p.replace(/(\[[^\]]+])|(LTS?|l{1,4}|L{1,4})/g,function(f,u,y){var S=y&&y.toUpperCase();return u||x[y]||s[y]||x[S].replace(/(\[[^\]]+])|(MMMM|MM|DD|dddd)/g,function(h,b,T){return b||T.slice(1)})})}(d,c===void 0?{}:c);return a.call(this,m)}}})})(le);const ot=le.exports;g.extend(nt);g.extend(ot);const X={pending:{color:"yellow",icon:e.exports.jsx(we,{})},finished:{color:"green",icon:e.exports.jsx(Z,{})},delivered:{color:"cyan",icon:e.exports.jsx(Pe,{})}},ce=1,de=1e6,J=w.object({price:w.number({invalid_type_error:"Required"}).min(ce).max(de)});function it({order:t,clientName:r,visibleNumbers:s,setFormValues:n,openOrderForm:o}){const i=be(),l=Se({smallerThan:"sm"}),a=ee({initialValues:{},validate:te(J)}),[d,c]=E(!1),m={centered:!0,target:".modal-container"},p=()=>B({title:e.exports.jsx(F,{order:5,children:"Are you sure you want to mark this order as pending again?"}),children:e.exports.jsx(j,{size:"sm",children:"The delivery date will be lost."}),labels:{confirm:"Confirm",cancel:"Cancel"},onConfirm:()=>C(t.id,{status:"pending",deliveredTimestamp:null}),...m}),x=()=>B({title:e.exports.jsx(F,{order:5,children:"Are you sure you want to delete this order?"}),labels:{confirm:"Delete",cancel:"Cancel"},onConfirm:()=>Ye(t.id),confirmProps:{color:"red"},...m}),f={hover:!0,focus:!0,touch:!0};return e.exports.jsxs(O.Row,{layoutId:t.id,children:[e.exports.jsx("td",{children:e.exports.jsxs(R,{position:"right",trapFocus:!0,opened:d,onChange:c.toggle,children:[e.exports.jsx(R.Target,{children:e.exports.jsx(L,{label:`Set as ${t.status==="pending"?"finished":t.status==="finished"?"delivered":"pending"}`,openDelay:500,withinPortal:!0,children:e.exports.jsx(M,{size:"xs",variant:"light",color:X[t.status].color,fullWidth:!0,onClick:()=>{switch(t.status){case"pending":{t.price?C(t.id,{status:"finished"}):(a.reset(),c.open());break}case"finished":{C(t.id,{status:"delivered",deliveredTimestamp:g().valueOf()});break}case"delivered":{p();break}}},children:l?X[t.status].icon:e.exports.jsx(j,{transform:"capitalize",children:t.status})})})}),e.exports.jsx(R.Dropdown,{children:e.exports.jsx("form",{onSubmit:a.onSubmit(u=>{c.close(),C(t.id,{status:"finished",...J.parse(u)})}),children:e.exports.jsxs(v,{spacing:"sm",align:"flex-start",children:[e.exports.jsx(se,{icon:e.exports.jsx(N,{}),placeholder:"Enter price",min:ce,max:de,...a.getInputProps("price")}),e.exports.jsx(I,{variant:"filled",color:i.primaryColor,my:1,type:"submit",children:e.exports.jsx(Z,{})})]})})})]})}),e.exports.jsx("td",{children:r||e.exports.jsx(j,{italic:!0,children:"Deleted"})}),e.exports.jsx("td",{style:{textAlign:"right"},children:s?t.price?`$${t.price.toLocaleString()}`:e.exports.jsx(st,{p:0,color:"gray",sx:{backgroundColor:"transparent"},children:"Pending"}):"*****"}),e.exports.jsx("td",{children:e.exports.jsx(L,{label:g(t.receivedTimestamp).calendar(g(),{sameElse:"llll"}),events:f,openDelay:500,children:e.exports.jsx(j,{sx:{cursor:"help"},children:g(t.receivedTimestamp).format("L")})})}),e.exports.jsx("td",{children:e.exports.jsx(L,{label:g(t.deliveredTimestamp).calendar(g(),{sameElse:"llll"}),events:f,openDelay:500,disabled:!t.deliveredTimestamp,children:e.exports.jsx(j,{sx:{cursor:t.deliveredTimestamp?"help":"default"},children:t.deliveredTimestamp?g(t.deliveredTimestamp).format("L"):"-"})})}),e.exports.jsx("td",{children:e.exports.jsxs(v,{position:"right",spacing:0,noWrap:!0,children:[e.exports.jsx(L,{label:"Edit",children:e.exports.jsx(I,{color:i.primaryColor,onClick:()=>{n(t),o()},children:e.exports.jsx(Le,{})})}),e.exports.jsx(L,{label:"Delete",children:e.exports.jsx(I,{color:"red",onClick:x,children:e.exports.jsx(Ce,{})})})]})})]})}const pe=1e6,A=w.object({clientId:w.string({invalid_type_error:"Required"}).trim().min(1,{message:"Required"}),price:w.number().min(0).max(pe).optional().default(0)});function at({opened:t,closeForm:r,values:s,clients:n}){const o=ee({initialValues:{clientId:""},validate:te(A)}),[i,l]=_.exports.useState(!1);return _.exports.useEffect(()=>{t&&(s?o.setValues({...s,price:s.price||void 0}):o.reset())},[t]),e.exports.jsx(Oe,{opened:t,title:e.exports.jsx(F,{order:5,children:s?"Edit order":"Add order"}),size:520,trapFocus:!0,onClose:r,target:".modal-container",children:e.exports.jsxs("form",{onSubmit:o.onSubmit(a=>{r(),s?C(s.id,A.parse(a)):$e({...A.parse(a),status:"pending",receivedTimestamp:g().valueOf(),deliveredTimestamp:null})}),children:[e.exports.jsxs(v,{align:"flex-start",spacing:"sm",grow:!0,children:[e.exports.jsx(Ae,{label:"Client",data:(n==null?void 0:n.map(a=>({value:a.id,label:a.name})))??[],icon:i?e.exports.jsx(_e,{size:16}):e.exports.jsx(Me,{}),placeholder:i?"Loading client...":"Select client",nothingFound:"Client not found",initiallyOpened:!1,maxLength:36,creatable:!0,searchable:!0,selectOnBlur:!0,"data-autofocus":s?void 0:!0,disabled:i,getCreateLabel:a=>`+ Add client ${a}`,onCreate:async a=>{l(!0);const d=await re({name:a}),c=await De(d);l(!1),o.setFieldValue("clientId",c.id)},...o.getInputProps("clientId")}),e.exports.jsx(se,{label:"Price",icon:e.exports.jsx(N,{}),placeholder:"Pending",min:0,max:pe,"data-autofocus":!0,...o.getInputProps("price")})]}),e.exports.jsx(v,{position:"right",mt:"md",children:e.exports.jsx(M,{type:"submit",children:"Confirm"})})]})})}function mt({visibleNumbers:t}){const r=W(Te,V("name","asc")),[s,n]=U(r),[o,i]=Re({key:"order-filters",defaultValue:{status:"all",orderBy:"receivedTimestamp",direction:"desc",clients:[]},getInitialValueInEffect:!1}),l=h=>{i(b=>({...b,...h}))},a=[V(o.orderBy,o.direction)];o.status!=="all"&&a.push(H("status","==",o.status)),o.clients.length&&a.push(H("clientId","in",o.clients));const d=W(Ie,...a),[c,m]=U(d),[p,x]=E(!1),[f,u]=E(!1),[y,S]=_.exports.useState();return e.exports.jsxs(k,{children:[e.exports.jsx(k.Header,{title:"Orders",loading:n||m,buttons:e.exports.jsxs(e.exports.Fragment,{children:[e.exports.jsx(M,{leftIcon:e.exports.jsx(ke,{}),onClick:()=>{S(void 0),x.open()},children:"New order"}),e.exports.jsx(M,{variant:"light",leftIcon:e.exports.jsx(ze,{}),onClick:u.open,children:"Manage clients"})]}),filters:e.exports.jsx(rt,{clients:s,filters:o,updateFilter:l}),withNumbersToggle:!0}),e.exports.jsxs(k.Body,{children:[e.exports.jsx(at,{opened:p,closeForm:x.close,values:y,clients:s}),e.exports.jsx(Ee,{opened:f,close:u.close,label:"client",items:s,addItem:re}),e.exports.jsx(Fe,{in:!!(s&&c),children:e.exports.jsxs(O,{children:[e.exports.jsxs(O.Header,{children:[e.exports.jsx("th",{style:{width:0},children:"Status"}),e.exports.jsx("th",{children:"Client"}),e.exports.jsx("th",{style:{width:0,textAlign:"right"},children:"Price"}),e.exports.jsx("th",{style:{width:0,textAlign:"center"},children:"Received"}),e.exports.jsx("th",{style:{width:0,textAlign:"center"},children:"Delivered"}),e.exports.jsx("th",{style:{width:0}})]}),e.exports.jsx(O.Body,{children:c==null?void 0:c.map(h=>{var b;return e.exports.jsx(it,{order:h,clientName:(b=s==null?void 0:s.find(T=>T.id===h.clientId))==null?void 0:b.name,visibleNumbers:t,setFormValues:S,openOrderForm:x.open},h.id)})})]})})]})]})}export{mt as default};
