import{ad as P,u as V,j as r,a5 as R,aO as K,G as E,ar as Q,T as D,aI as W,aJ as A,aK as H,I as U,t as Y,v as _,$ as J,x as N,r as O,z as q,_ as X,a3 as B,aH as Z}from"./index-5ff1983a.js";import{u as I,L as ee}from"./useCollectionDataPersistent-3151dea0.js";import{D as te,C as z,O as ne}from"./nivo-legends.es-52dec924.js";import{d,M as ae}from"./dayjs.min-c1d4d187.js";import{c as oe}from"./customParseFormat-84084c91.js";import{M as re}from"./nivo-bar.es-95cc3d35.js";import{L as se}from"./LabeledSegmentedControl-01309ecf.js";import{S as le}from"./SelectValue-fc68a897.js";import{S as ie}from"./Select-ea469a6c.js";import"./Badge-f1b67808.js";import"./use-input-props-04222ffb.js";var T={},ce={get exports(){return T},set exports(n){T=n}};(function(n,u){(function(i,c){n.exports=c()})(P,function(){return function(i,c){c.prototype.isSameOrBefore=function(o,h){return this.isSame(o,h)||this.isBefore(o,h)}}})})(ce);const me=T;var $={},de={get exports(){return $},set exports(n){$=n}};(function(n,u){(function(i,c){n.exports=c()})(P,function(){return function(i,c,o){var h=c.prototype,a=function(e){return e&&(e.indexOf?e:e.s)},s=function(e,t,w,j,M){var y=e.name?e:e.$locale(),x=a(y[t]),S=a(y[w]),k=x||S.map(function(p){return p.slice(0,j)});if(!M)return k;var C=y.weekStart;return k.map(function(p,b){return k[(b+(C||0))%7]})},m=function(){return o.Ls[o.locale()]},f=function(e,t){return e.formats[t]||function(w){return w.replace(/(\[[^\]]+])|(MMMM|MM|DD|dddd)/g,function(j,M,y){return M||y.slice(1)})}(e.formats[t.toUpperCase()])},l=function(){var e=this;return{months:function(t){return t?t.format("MMMM"):s(e,"months")},monthsShort:function(t){return t?t.format("MMM"):s(e,"monthsShort","months",3)},firstDayOfWeek:function(){return e.$locale().weekStart||0},weekdays:function(t){return t?t.format("dddd"):s(e,"weekdays")},weekdaysMin:function(t){return t?t.format("dd"):s(e,"weekdaysMin","weekdays",2)},weekdaysShort:function(t){return t?t.format("ddd"):s(e,"weekdaysShort","weekdays",3)},longDateFormat:function(t){return f(e.$locale(),t)},meridiem:this.$locale().meridiem,ordinal:this.$locale().ordinal}};h.localeData=function(){return l.bind(this)()},o.localeData=function(){var e=m();return{firstDayOfWeek:function(){return e.weekStart||0},weekdays:function(){return o.weekdays()},weekdaysShort:function(){return o.weekdaysShort()},weekdaysMin:function(){return o.weekdaysMin()},months:function(){return o.months()},monthsShort:function(){return o.monthsShort()},longDateFormat:function(t){return f(e,t)},meridiem:e.meridiem,ordinal:e.ordinal}},o.months=function(){return s(m(),"months")},o.monthsShort=function(){return s(m(),"monthsShort","months",3)},o.weekdays=function(e){return s(m(),"weekdays",null,null,e)},o.weekdaysShort=function(e){return s(m(),"weekdaysShort","weekdays",3,e)},o.weekdaysMin=function(e){return s(m(),"weekdaysMin","weekdays",2,e)}}})})(de);const G=$;function ue({data:n,keys:u,timeframe:i,height:c=260,enableLeftTicks:o,enableLabels:h}){const a=V();return r.jsx(R,{pt:"md",sx:{height:c,width:"100%"},children:!!n.length&&r.jsx(re,{data:n,keys:u,margin:{top:6,bottom:i==="year"?28:6,left:o?44:0},valueScale:{type:"linear"},indexScale:{type:"band"},axisLeft:{tickValues:3},axisBottom:i==="year"?{tickSize:5,tickPadding:5,tickRotation:0,legendPosition:"middle",legendOffset:32}:null,indexBy:"month",groupMode:i==="year"?"stacked":"grouped",defs:[te("gradient",[{offset:0,color:"inherit"},{offset:100,color:"inherit",opacity:a.colorScheme==="dark"?.25:.5}])],fill:[{match:"*",id:"gradient"}],theme:{textColor:a.colorScheme==="dark"?a.colors.dark[2]:a.colors.gray[6],fontSize:12,axis:{ticks:{line:{strokeWidth:o?2:0}}},crosshair:{line:{stroke:a.colorScheme==="dark"?a.colors.dark[1]:a.colors.gray[7]}}},tooltip:({id:s,value:m,data:f})=>{const l=f[`${s}Color`];return r.jsx(K,{p:"sm",bg:a.colorScheme==="dark"?a.colors.dark[8]:a.colors.gray[1],shadow:a.shadows.md,children:r.jsxs(E,{spacing:"sm",children:[r.jsx(Q,{size:14,color:a.colors[l][a.fn.primaryShade()]}),r.jsx(D,{size:"sm",color:"dimmed",inline:!0,children:s}),r.jsx(D,{size:"sm",weight:"bold",inline:!0,children:m})]},s)})},colors:({id:s,data:m})=>{const f=m[`${s}Color`];return f?a.colors[f][a.fn.primaryShade()]:a.primaryColor[a.fn.primaryShade()]},enableLabel:h,labelTextColor:({color:s})=>a.colorScheme==="dark"?a.fn.lighten(s,.25):a.fn.darken(s,.25),padding:o?.4/u.length:0,borderRadius:4,enableGridY:!1,motionConfig:"default"})})}d.extend(G);const fe=U(n=>({grid:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(300px, 1fr))",gap:n.spacing.sm}})),he=["Month","Year"];function pe({filters:n,updateFilter:u,tags:i,months:c,selectedMonth:o,setSelectedMonth:h,years:a,selectedYear:s,setSelectedYear:m}){const{classes:f}=fe();return r.jsxs(R,{className:f.grid,children:[r.jsxs(E,{spacing:"sm",grow:!0,children:[r.jsx(se,{label:"Timeframe",data:he.map(l=>({label:l,value:l.toLowerCase()})),value:n.timeframe,onChange:l=>u({timeframe:l})}),r.jsx(ie,{label:n.timeframe==="month"?"Month":"Year",data:n.timeframe==="month"?c.map((l,e)=>({label:d.months()[e],value:l})):a,icon:r.jsx(W,{}),placeholder:`Select ${n.timeframe}`,value:n.timeframe==="month"?o:s,onChange:l=>(n.timeframe==="month"?h:m)(l??""),clearable:!1})]}),r.jsx(ae,{label:"Filter by tags",data:(i==null?void 0:i.map(({id:l,name:e,color:t})=>({value:l,label:e,color:t})))??[],icon:r.jsx(A,{}),placeholder:"Select tags",nothingFound:"Tag not found",itemComponent:H,valueComponent:le,searchable:!0,value:n.showOnly,onChange:l=>u({showOnly:l})}),r.jsxs(E,{pt:6,children:[r.jsx(z,{checked:n.enableLeftTicks,label:"Enable left ticks",onChange:({target:{checked:l}})=>u({enableLeftTicks:l})}),r.jsx(z,{checked:n.enableLabels,label:"Enable labels",onChange:({target:{checked:l}})=>u({enableLabels:l})})]})]})}d.extend(oe);d.extend(G);d.extend(me);const F=d.monthsShort().filter(n=>d(n,"MMM").isSameOrBefore(d()));function Le({visibleNumbers:n}){const u=Y(J,_("name","asc")),[i]=I(u),[c,o]=N({key:"summary-filters",defaultValue:{timeframe:"year",showOnly:[],enableLeftTicks:!0,enableLabels:!0},getInitialValueInEffect:!1}),h=x=>{o(S=>({...S,...x}))},[a,s]=O.useState(d().format("MMM")),[m,f]=O.useState(d().format("YYYY")),l=[];c.showOnly.length&&l.push(q("tagIds","array-contains-any",c.showOnly));const e=Y(X,...l),[t]=I(e),{data:w,keys:j,totalExpenses:M,years:y}=O.useMemo(()=>{const x=[],S=new Set,k=new Set;let C=0;if(i&&t){for(const p of F){const b={month:p};for(const g of i){let v=0;for(const L of t)L.tagIds.includes(g.id)&&d(L.date).format("MMM")===p&&(v+=L.amount);(!c.showOnly.length||c.showOnly.includes(g.id))&&v&&(b[g.name]=v,b[`${g.name}Color`]=g.color,S.add(g.name))}x.push(b)}t.forEach(p=>{k.add(d(p.date).format("YYYY")),C+=p.amount})}return{data:x,keys:S,totalExpenses:C,years:k}},[i,t]);return r.jsxs(B,{children:[r.jsx(ee,{in:!!t&&!!i,style:{minHeight:336},children:r.jsxs(B,{spacing:0,children:[r.jsx(ne,{items:[{text:n?`$${M.toLocaleString()}`:"*****",sub:"Total"}]}),r.jsx(Z,{in:n&&!!(i!=null&&i.length)&&!!(t!=null&&t.length),children:r.jsx(ue,{data:w,keys:[...j],timeframe:c.timeframe,enableLeftTicks:c.enableLeftTicks,enableLabels:c.enableLabels})})]})}),r.jsx(pe,{filters:c,updateFilter:h,tags:i,months:F,selectedMonth:a,setSelectedMonth:s,years:[...y],selectedYear:m,setSelectedYear:f})]})}export{Le as default};
