import{r as m,c as mt,a5 as gt,a6 as pe,a7 as he,R as _,Y as xt,l as be,a8 as wt,j as T,a9 as ve,F as me,b as s,p as N,A as K,s as bt,T as Ie,t as vt,v as It,y as Dt,z as De,aa as St,M as yt,ab as ge,ac as Ct,ad as Ot}from"./index-a850c355.js";import{D as _t,u as Pt,g as Et,S as X,a as Lt,b as Rt,c as kt,d as zt}from"./LabeledSegmentedControl-6dde63de.js";import{c as Tt,T as Se,f as Mt,g as Vt}from"./index-5a84c722.js";import{I as xe}from"./useCollectionDataPersistent-84d18d88.js";function Ft(t){return n=>{if(!n)t(n);else if(typeof n=="function")t(n);else if(typeof n=="object"&&"nativeEvent"in n){const{currentTarget:a}=n;a.type==="checkbox"?t(a.checked):t(a.value)}else t(n)}}function ye(t){const[n,a]=m.exports.useState(t);return[n,Ft(a)]}function Bt({data:t,searchable:n,limit:a,searchValue:o,filter:v,value:D,filterDataOnExactSearchMatch:S}){if(!n)return t;const u=D!=null&&t.find(l=>l.value===D)||null;if(u&&!S&&(u==null?void 0:u.label)===o){if(a){if(a>=t.length)return t;const l=t.indexOf(u),O=l+a,i=O-t.length;return i>0?t.slice(l-i):t.slice(l,O)}return t}const g=[];for(let l=0;l<t.length&&(v(o,t[l])&&g.push(t[l]),!(g.length>=a));l+=1);return g}var $t=mt(()=>({input:{"&:not(:disabled)":{cursor:"pointer","&::selection":{backgroundColor:"transparent"}}}}));const At=$t;var jt=Object.defineProperty,Ht=Object.defineProperties,Nt=Object.getOwnPropertyDescriptors,U=Object.getOwnPropertySymbols,Ce=Object.prototype.hasOwnProperty,Oe=Object.prototype.propertyIsEnumerable,we=(t,n,a)=>n in t?jt(t,n,{enumerable:!0,configurable:!0,writable:!0,value:a}):t[n]=a,F=(t,n)=>{for(var a in n||(n={}))Ce.call(n,a)&&we(t,a,n[a]);if(U)for(var a of U(n))Oe.call(n,a)&&we(t,a,n[a]);return t},ee=(t,n)=>Ht(t,Nt(n)),Kt=(t,n)=>{var a={};for(var o in t)Ce.call(t,o)&&n.indexOf(o)<0&&(a[o]=t[o]);if(t!=null&&U)for(var o of U(t))n.indexOf(o)<0&&Oe.call(t,o)&&(a[o]=t[o]);return a};function Ut(t,n){return n.label.toLowerCase().trim().includes(t.toLowerCase().trim())}function Wt(t,n){return!!t&&!n.some(a=>a.label.toLowerCase()===t.toLowerCase())}const Yt={required:!1,size:"sm",shadow:"sm",itemComponent:_t,transition:"fade",transitionDuration:0,initiallyOpened:!1,filter:Ut,maxDropdownHeight:220,searchable:!1,clearable:!1,limit:1/0,disabled:!1,creatable:!1,shouldCreate:Wt,selectOnBlur:!1,switchDirectionOnFlip:!1,filterDataOnExactSearchMatch:!1,zIndex:gt("popover"),clearButtonTabIndex:0,positionDependencies:[],dropdownPosition:"flip"},Zt=m.exports.forwardRef((t,n)=>{const a=Tt("Select",Yt,t),{inputProps:o,wrapperProps:v,shadow:D,data:S,value:u,defaultValue:g,onChange:l,itemComponent:O,onKeyDown:i,onBlur:te,onFocus:ne,transition:_e,transitionDuration:Pe,initiallyOpened:Ee,transitionTimingFunction:Gt,unstyled:ae,classNames:k,styles:B,filter:Le,maxDropdownHeight:Re,searchable:I,clearable:W,nothingFound:oe,clearButtonLabel:ke,limit:ze,disabled:Y,onSearchChange:Z,searchValue:Te,rightSection:Me,rightSectionWidth:Ve,creatable:Fe,getCreateLabel:re,shouldCreate:Be,selectOnBlur:$e,onCreate:le,dropdownComponent:Ae,onDropdownClose:je,onDropdownOpen:He,withinPortal:Ne,switchDirectionOnFlip:Ke,zIndex:Ue,name:We,dropdownPosition:Ye,allowDeselect:se,placeholder:Ze,filterDataOnExactSearchMatch:qe,clearButtonTabIndex:Ge,form:Je,positionDependencies:Qe,readOnly:P}=a,Xe=Kt(a,["inputProps","wrapperProps","shadow","data","value","defaultValue","onChange","itemComponent","onKeyDown","onBlur","onFocus","transition","transitionDuration","initiallyOpened","transitionTimingFunction","unstyled","classNames","styles","filter","maxDropdownHeight","searchable","clearable","nothingFound","clearButtonLabel","limit","disabled","onSearchChange","searchValue","rightSection","rightSectionWidth","creatable","getCreateLabel","shouldCreate","selectOnBlur","onCreate","dropdownComponent","onDropdownClose","onDropdownOpen","withinPortal","switchDirectionOnFlip","zIndex","name","dropdownPosition","allowDeselect","placeholder","filterDataOnExactSearchMatch","clearButtonTabIndex","form","positionDependencies","readOnly"]),{classes:et,cx:tt,theme:nt}=At(),[f,at]=m.exports.useState(Ee),[y,d]=m.exports.useState(-1),q=m.exports.useRef(),$=m.exports.useRef({}),[ie,ot]=m.exports.useState("column"),E=ie==="column",{scrollIntoView:M,targetRef:G,scrollableRef:rt}=Pt({duration:0,offset:5,cancelable:!1,isList:!0}),lt=se===void 0?W:se,x=e=>{if(f!==e){at(e);const r=e?He:je;typeof r=="function"&&r()}},J=Fe&&typeof re=="function";let Q=null;const st=S.map(e=>typeof e=="string"?{label:e,value:e}:e),A=Et({data:st}),[w,z,ce]=pe({value:u,defaultValue:g,finalValue:null,onChange:l}),C=A.find(e=>e.value===w),[L,it]=pe({value:Te,defaultValue:(C==null?void 0:C.label)||"",finalValue:void 0,onChange:Z}),R=e=>{it(e),I&&typeof Z=="function"&&Z(e)},ct=()=>{var e;P||(z(null),ce||R(""),(e=q.current)==null||e.focus())};m.exports.useEffect(()=>{const e=A.find(r=>r.value===w);e?R(e.label):(!J||!w)&&R("")},[w]),m.exports.useEffect(()=>{C&&(!I||!f)&&R(C.label)},[C==null?void 0:C.label]);const j=e=>{if(!P)if(lt&&(C==null?void 0:C.value)===e.value)z(null),x(!1);else{if(e.creatable&&typeof le=="function"){const r=le(e.value);typeof r<"u"&&r!==null&&z(typeof r=="string"?r:r.value)}else z(e.value);ce||R(e.label),d(-1),x(!1),q.current.focus()}},c=Bt({data:A,searchable:I,limit:ze,searchValue:L,filter:Le,filterDataOnExactSearchMatch:qe,value:w});J&&Be(L,c)&&(Q=re(L),c.push({label:L,value:L,creatable:!0}));const ue=(e,r,p)=>{let h=e;for(;p(h);)if(h=r(h),!c[h].disabled)return h;return e};he(()=>{d(-1)},[L]);const V=w?c.findIndex(e=>e.value===w):0,b=!P&&(c.length>0?f:f&&!!oe),de=()=>{d(e=>{var r;const p=ue(e,h=>h-1,h=>h>0);return G.current=$.current[(r=c[p])==null?void 0:r.value],b&&M({alignment:E?"start":"end"}),p})},fe=()=>{d(e=>{var r;const p=ue(e,h=>h+1,h=>h<c.length-1);return G.current=$.current[(r=c[p])==null?void 0:r.value],b&&M({alignment:E?"end":"start"}),p})},H=()=>window.setTimeout(()=>{var e;G.current=$.current[(e=c[V])==null?void 0:e.value],M({alignment:E?"end":"start"})},0);he(()=>{b&&H()},[b]);const ut=e=>{switch(typeof i=="function"&&i(e),e.key){case"ArrowUp":{e.preventDefault(),f?E?de():fe():(d(V),x(!0),H());break}case"ArrowDown":{e.preventDefault(),f?E?fe():de():(d(V),x(!0),H());break}case"Home":{if(!I){e.preventDefault(),f||x(!0);const r=c.findIndex(p=>!p.disabled);d(r),b&&M({alignment:E?"end":"start"})}break}case"End":{if(!I){e.preventDefault(),f||x(!0);const r=c.map(p=>!!p.disabled).lastIndexOf(!1);d(r),b&&M({alignment:E?"end":"start"})}break}case"Escape":{e.preventDefault(),x(!1),d(-1);break}case" ":{I||(e.preventDefault(),c[y]&&f?j(c[y]):(x(!0),d(V),H()));break}case"Enter":I||e.preventDefault(),c[y]&&f&&(e.preventDefault(),j(c[y]))}},dt=e=>{typeof te=="function"&&te(e);const r=A.find(p=>p.value===w);$e&&c[y]&&f&&j(c[y]),R((r==null?void 0:r.label)||""),x(!1)},ft=e=>{typeof ne=="function"&&ne(e),I&&x(!0)},pt=e=>{P||(R(e.currentTarget.value),W&&e.currentTarget.value===""&&z(null),d(-1),x(!0))},ht=()=>{P||(x(!f),w&&!f&&d(V))};return _.createElement(xe.Wrapper,ee(F({},v),{__staticSelector:"Select"}),_.createElement(X,{opened:b,transition:_e,transitionDuration:Pe,shadow:"sm",withinPortal:Ne,__staticSelector:"Select",onDirectionChange:ot,switchDirectionOnFlip:Ke,zIndex:Ue,dropdownPosition:Ye,positionDependencies:Qe,classNames:k,styles:B,unstyled:ae},_.createElement(X.Target,null,_.createElement("div",{role:"combobox","aria-haspopup":"listbox","aria-owns":b?`${o.id}-items`:null,"aria-controls":o.id,"aria-expanded":b,onMouseLeave:()=>d(-1),tabIndex:-1},_.createElement("input",{type:"hidden",name:We,value:w||"",form:Je,disabled:Y}),_.createElement(xe,F(ee(F(F({autoComplete:"off",type:"search"},o),Xe),{ref:xt(n,q),onKeyDown:ut,__staticSelector:"Select",value:L,placeholder:Ze,onChange:pt,"aria-autocomplete":"list","aria-controls":b?`${o.id}-items`:null,"aria-activedescendant":y>=0?`${o.id}-${y}`:null,onMouseDown:ht,onBlur:dt,onFocus:ft,readOnly:!I||P,disabled:Y,"data-mantine-stop-propagation":b,name:null,classNames:ee(F({},k),{input:tt({[et.input]:!I},k==null?void 0:k.input)})}),Lt({theme:nt,rightSection:Me,rightSectionWidth:Ve,styles:B,size:o.size,shouldClear:W&&!!C,clearButtonLabel:ke,onClear:ct,error:v.error,clearButtonTabIndex:Ge,disabled:Y,readOnly:P}))))),_.createElement(X.Dropdown,{component:Ae||Rt,maxHeight:Re,direction:ie,id:o.id,innerRef:rt,__staticSelector:"Select",classNames:k,styles:B},_.createElement(kt,{data:c,hovered:y,classNames:k,styles:B,isItemSelected:e=>e===w,uuid:o.id,__staticSelector:"Select",onItemHover:d,onItemSelect:j,itemsRefs:$,itemComponent:O,size:o.size,nothingFound:oe,creatable:J&&!!Q,createLabel:Q,"aria-label":v.label,unstyled:ae}))))});Zt.displayName="@mantine/core/Select";function qt({item:t,label:n}){const a=be(),o=wt(()=>S(!1)),v=m.exports.useRef(null),[D,S]=m.exports.useState(!1),[u,g]=ye(t.name),l=`${n}s`,O=()=>Dt({title:s(De,{order:5,children:`Are you sure you want to delete this ${n}?`}),labels:{confirm:"Delete",cancel:"Cancel"},onConfirm:()=>Vt(l,t.id),confirmProps:{color:"red"},size:"auto",centered:!0,target:".modal-container",zIndex:3});return m.exports.useEffect(()=>{var i;D&&(g(t.name),(i=v.current)==null||i.focus())},[D]),T(ve.div,{ref:o,style:{display:"flex",alignItems:"center"},layoutId:t.id,layoutScroll:!0,children:[D?T(me,{children:[s(Se,{ref:v,placeholder:"Enter name","data-autofocus":!0,pr:"xs",styles:i=>({input:{minHeight:34,height:34,paddingInline:i.spacing.xs-1}}),sx:{flex:1},value:u,onChange:i=>g(i)}),s(N,{label:"Confirm",withinPortal:!0,children:s(K,{color:a.primaryColor,onClick:()=>{S(!1),Mt(l,t.id,{name:u})},children:s(bt,{})})})]}):T(me,{children:[s(Ie,{size:"sm",px:"xs",sx:{flex:1},children:t.name}),s(N,{label:"Edit name",withinPortal:!0,children:s(K,{color:a.primaryColor,onClick:()=>S(!0),children:s(vt,{})})})]}),s(N,{label:"Delete",withinPortal:!0,children:s(K,{color:"red",onClick:O,children:s(It,{})})})]})}function tn({opened:t,close:n,label:a,items:o,addItem:v}){const D=be(),{height:S}=St(),[u,g]=ye(""),l=o==null?void 0:o.filter(i=>i.name.match(new RegExp(u,"gi"))),O=!!(l!=null&&l.find(i=>i.name.toLowerCase()===u.toLowerCase()));return m.exports.useEffect(()=>{t&&g("")},[t]),s(yt,{opened:t,title:s(De,{order:5,children:`Manage ${a}s`}),size:420,overflow:"inside",trapFocus:!0,onClose:n,target:".modal-container",zIndex:2,children:T(ge,{spacing:"sm",children:[s(Se,{icon:s(Ct,{}),placeholder:`Search ${a}`,maxLength:36,"data-autofocus":!0,value:u,onChange:g}),s(zt.Autosize,{maxHeight:`calc(${S}px - 240px)`,children:T(ge,{spacing:"xs",pb:2,children:[l==null?void 0:l.map(i=>s(qt,{item:i,label:a},i.id)),!!u.length&&!O&&T(ve.div,{style:{display:"flex",alignItems:"center"},layoutId:"search",children:[s(Ie,{size:"sm",px:"xs",sx:{flex:1},children:u}),s(N,{label:`Add ${a}`,withinPortal:!0,children:s(K,{color:D.primaryColor,onClick:()=>{v({name:u}),g("")},children:s(Ot,{})})})]})]})})]})})}export{tn as L,Zt as S};
