import{r as y,J as ge,ao as he,H as O,G as M,I as ze,an as Le,a8 as $e,a5 as ve,u as J,j as n,aO as Ne,ar as xe,T as A,g as Re,P as G,i as be,a1 as Y,A as Ie,E as K,B as Z,a3 as $,aJ as Ve,aP as Ae,q as Be,aa as He,x as De,t as ee,v as re,V as Ue,W as We,aH as Ge}from"./index-5ff1983a.js";import{L as ye,u as oe}from"./useCollectionDataPersistent-3151dea0.js";import{G as Ye,D as Fe,C as ne,O as qe}from"./nivo-legends.es-52dec924.js";import{H as Xe,t as Je}from"./tinycolor-37538c74.js";import{M as Qe}from"./nivo-bar.es-95cc3d35.js";import{u as Ke,z as Ze,p as er,T as rr,N as or,m as I,q as nr}from"./index-a67f9d8b.js";import"./clamp-23377890.js";import"./use-input-props-04222ffb.js";const me=y.createContext(null),ar=me.Provider,tr=()=>y.useContext(me);var sr=Object.defineProperty,B=Object.getOwnPropertySymbols,Ce=Object.prototype.hasOwnProperty,ke=Object.prototype.propertyIsEnumerable,ae=(e,o,r)=>o in e?sr(e,o,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[o]=r,lr=(e,o)=>{for(var r in o||(o={}))Ce.call(o,r)&&ae(e,r,o[r]);if(B)for(var r of B(o))ke.call(o,r)&&ae(e,r,o[r]);return e},ir=(e,o)=>{var r={};for(var a in e)Ce.call(e,a)&&o.indexOf(a)<0&&(r[a]=e[a]);if(e!=null&&B)for(var a of B(e))o.indexOf(a)<0&&ke.call(e,a)&&(r[a]=e[a]);return r};const cr={spacing:"xs"};function je(e){const o=ge("ChipGroup",cr,e),{value:r,defaultValue:a,onChange:c,spacing:l,multiple:t,children:s,unstyled:d}=o,i=ir(o,["value","defaultValue","onChange","spacing","multiple","children","unstyled"]),[h,C]=he({value:r,defaultValue:a,finalValue:t?[]:null,onChange:c}),u=x=>Array.isArray(h)?h.includes(x):x===h,v=x=>{const p=x.currentTarget.value;Array.isArray(h)?C(h.includes(p)?h.filter(S=>S!==p):[...h,p]):C(p)};return O.createElement(ar,{value:{isChipSelected:u,onChange:v,multiple:t}},O.createElement(M,lr({spacing:l,unstyled:d},i),s))}je.displayName="@mantine/core/ChipGroup";var dr=Object.defineProperty,ur=Object.defineProperties,pr=Object.getOwnPropertyDescriptors,te=Object.getOwnPropertySymbols,fr=Object.prototype.hasOwnProperty,gr=Object.prototype.propertyIsEnumerable,se=(e,o,r)=>o in e?dr(e,o,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[o]=r,w=(e,o)=>{for(var r in o||(o={}))fr.call(o,r)&&se(e,r,o[r]);if(te)for(var r of te(o))gr.call(o,r)&&se(e,r,o[r]);return e},le=(e,o)=>ur(e,pr(o));const ie={xs:24,sm:28,md:32,lg:36,xl:40},L={xs:10,sm:12,md:14,lg:16,xl:18},ce={xs:16,sm:20,md:24,lg:28,xl:32},de={xs:7.5,sm:10,md:11.5,lg:13,xl:15};var hr=ze((e,{radius:o,size:r,color:a},c)=>({root:{},label:le(w({ref:c("label")},e.fn.fontStyles()),{boxSizing:"border-box",color:e.colorScheme==="dark"?e.colors.dark[0]:e.black,display:"inline-block",alignItems:"center",userSelect:"none",border:"1px solid transparent",borderRadius:e.fn.radius(o),height:e.fn.size({size:r,sizes:ie}),fontSize:e.fn.size({size:r,sizes:e.fontSizes}),lineHeight:`${e.fn.size({size:r,sizes:ie})-2}px`,paddingLeft:e.fn.size({size:r,sizes:ce}),paddingRight:e.fn.size({size:r,sizes:ce}),cursor:"pointer",whiteSpace:"nowrap",transition:"background-color 100ms ease",WebkitTapHighlightColor:"transparent",'&[data-variant="filled"]':w({backgroundColor:e.colorScheme==="dark"?e.colors.dark[4]:e.colors.gray[1]},e.fn.hover({backgroundColor:e.colorScheme==="dark"?e.colors.dark[5]:e.colors.gray[0]})),'&[data-variant="outline"]':w({backgroundColor:e.colorScheme==="dark"?e.colors.dark[6]:e.white,borderColor:e.colorScheme==="dark"?e.colors.dark[4]:e.colors.gray[4]},e.fn.hover({backgroundColor:e.colorScheme==="dark"?e.colors.dark[5]:e.colors.gray[0]})),"&[data-disabled]":le(w({backgroundColor:`${e.colorScheme==="dark"?e.colors.dark[5]:e.colors.gray[1]} !important`,borderColor:`${e.colorScheme==="dark"?e.colors.dark[5]:e.colors.gray[1]} !important`,color:e.colorScheme==="dark"?e.colors.dark[3]:e.colors.gray[5],cursor:"not-allowed"},e.fn.hover({backgroundColor:e.colorScheme==="dark"?e.colors.dark[5]:e.colors.gray[1]})),{[`& .${c("iconWrapper")}`]:{color:e.colorScheme==="dark"?e.colors.dark[3]:e.colors.gray[5]}}),"&[data-checked]":{paddingLeft:e.fn.size({size:r,sizes:de}),paddingRight:e.fn.size({size:r,sizes:de}),'&[data-variant="outline"]':{border:`1px solid ${e.fn.variant({variant:"filled",color:a}).background}`},'&[data-variant="filled"]':{"&, &:hover":{backgroundColor:e.fn.variant({variant:"light",color:a}).background}}}}),iconWrapper:{ref:c("iconWrapper"),color:e.fn.variant({variant:"filled",color:a}).background,width:e.fn.size({size:r,sizes:L})+e.fn.size({size:r,sizes:e.spacing})/1.5,maxWidth:e.fn.size({size:r,sizes:L})+e.fn.size({size:r,sizes:e.spacing})/1.5,height:e.fn.size({size:r,sizes:L}),display:"inline-block",verticalAlign:"middle",overflow:"hidden"},checkIcon:{width:e.fn.size({size:r,sizes:L}),height:e.fn.size({size:r,sizes:L})/1.1,display:"block"},input:{width:0,height:0,padding:0,opacity:0,margin:0,"&:focus":{outline:"none",[`& + .${c("label")}`]:w({},e.focusRing==="always"||e.focusRing==="auto"?e.focusRingStyles.styles(e):e.focusRingStyles.resetStyles(e)),"&:focus:not(:focus-visible)":{[`& + .${c("label")}`]:w({},e.focusRing==="auto"||e.focusRing==="never"?e.focusRingStyles.resetStyles(e):null)}}}}));const vr=hr;var xr=Object.defineProperty,H=Object.getOwnPropertySymbols,_e=Object.prototype.hasOwnProperty,Se=Object.prototype.propertyIsEnumerable,ue=(e,o,r)=>o in e?xr(e,o,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[o]=r,V=(e,o)=>{for(var r in o||(o={}))_e.call(o,r)&&ue(e,r,o[r]);if(H)for(var r of H(o))Se.call(o,r)&&ue(e,r,o[r]);return e},br=(e,o)=>{var r={};for(var a in e)_e.call(e,a)&&o.indexOf(a)<0&&(r[a]=e[a]);if(e!=null&&H)for(var a of H(e))o.indexOf(a)<0&&Se.call(e,a)&&(r[a]=e[a]);return r};const yr={type:"checkbox",size:"sm",radius:"xl",variant:"outline"},U=y.forwardRef((e,o)=>{const r=ge("Chip",yr,e),{radius:a,type:c,size:l,variant:t,disabled:s,id:d,color:i,children:h,className:C,classNames:u,style:v,styles:x,checked:p,defaultChecked:S,onChange:P,sx:E,wrapperProps:T,value:k,unstyled:z}=r,j=br(r,["radius","type","size","variant","disabled","id","color","children","className","classNames","style","styles","checked","defaultChecked","onChange","sx","wrapperProps","value","unstyled"]),_=tr(),f=Le(d),{systemStyles:g,rest:b}=$e(j),{classes:m,cx:R}=vr({radius:a,size:l,color:i},{classNames:u,styles:x,unstyled:z,name:"Chip"}),[we,Me]=he({value:p,defaultValue:S,finalValue:!1,onChange:P}),Q=_?{checked:_.isChipSelected(k),onChange:_.onChange,type:_.multiple?"checkbox":"radio"}:{},W=Q.checked||we;return O.createElement(ve,V(V({className:R(m.root,C),style:v,sx:E},g),T),O.createElement("input",V(V({type:c,className:m.input,checked:W,onChange:Te=>Me(Te.currentTarget.checked),id:f,disabled:s,ref:o,value:k},Q),b)),O.createElement("label",{htmlFor:f,"data-checked":W||void 0,"data-disabled":s||void 0,"data-variant":t,className:m.label},W&&O.createElement("span",{className:m.iconWrapper},O.createElement(Ye,{className:m.checkIcon})),h))});U.displayName="@mantine/core/Chip";U.Group=je;function mr({data:e,keys:o,markers:r,height:a=260,enableLeftTicks:c,enableLabels:l}){const t=J();return n.jsx(ve,{pt:"md",sx:{height:a,width:"100%"},children:!!e.length&&n.jsx(Qe,{data:e,keys:o,margin:{top:6,bottom:6,left:c?44:0},valueScale:{type:"linear"},indexScale:{type:"band"},axisLeft:{tickValues:3},axisBottom:null,groupMode:"grouped",defs:[Fe("gradient",[{offset:0,color:"inherit"},{offset:100,color:"inherit",opacity:t.colorScheme==="dark"?.25:.5}])],fill:[{match:"*",id:"gradient"}],theme:{textColor:t.colorScheme==="dark"?t.colors.dark[2]:t.colors.gray[6],fontSize:12,axis:{ticks:{line:{strokeWidth:c?2:0}}},crosshair:{line:{stroke:t.colorScheme==="dark"?t.colors.dark[1]:t.colors.gray[7]}}},tooltip:({id:s,value:d,data:i})=>n.jsx(Ne,{p:"sm",bg:t.colorScheme==="dark"?t.colors.dark[8]:t.colors.gray[1],shadow:t.shadows.md,children:n.jsxs(M,{spacing:"sm",children:[n.jsx(xe,{size:14,color:`${i[`${s}Color`]}`}),n.jsx(A,{size:"sm",color:"dimmed",inline:!0,children:s}),n.jsx(A,{size:"sm",weight:"bold",inline:!0,children:d})]},s)}),markers:r.map(({color:s,value:d})=>({axis:"y",lineStyle:{stroke:s},value:d})),colors:({id:s,data:d})=>d[`${s}Color`]?`${d[`${s}Color`]}`:t.colorScheme==="dark"?t.colors.dark[5]:t.colors.gray[3],enableLabel:l,labelTextColor:({color:s})=>t.colorScheme==="dark"?t.fn.lighten(s,.25):t.fn.darken(s,.25),padding:c?.4/o.length:0,innerPadding:80/o.length,borderRadius:4,enableGridY:!1,motionConfig:"default"})})}const Ee=10,Oe=1,Pe=1e5,pe=I.object({color:I.number(),name:I.string().trim().min(1,{message:"Required"}).max(Ee),value:I.number({invalid_type_error:"Required"}).min(Oe).max(Pe)});function Cr({markers:e,activeGroup:o,filters:r,updateFilter:a}){const c=J(),l=Ke({initialValues:{color:0,name:""},validate:Ze(pe)}),[t,s]=Re(!1),d=n.jsxs(G,{width:360,position:e!=null&&e.length?"bottom-end":"bottom-start",trapFocus:!0,opened:t,onChange:s.toggle,children:[n.jsx(G.Target,{children:e!=null&&e.length?n.jsx(be,{label:"Add marker",children:n.jsx(Y.div,{layoutId:"addMarkerButton",children:n.jsx(Ie,{color:c.primaryColor,variant:"light",size:"md",onClick:s.toggle,children:n.jsx(K,{})})})}):n.jsx(Y.div,{layoutId:"addMarkerButton",style:{width:"fit-content"},children:n.jsx(Z,{variant:"light",leftIcon:n.jsx(K,{}),h:34,onClick:s.toggle,children:"Add marker"})})}),n.jsx(G.Dropdown,{p:"md",children:n.jsx("form",{onSubmit:l.onSubmit(({color:i,...h})=>{o&&(s.close(),er(o.id,{color:`hsl(${i}, 100%, 50%)`,...pe.omit({color:!0}).parse(h)}))}),children:n.jsxs($,{spacing:"sm",children:[n.jsx(Xe,{value:l.values.color,onChange:i=>l.setFieldValue("color",i),onChangeEnd:i=>l.setFieldValue("color",i)}),n.jsxs(M,{align:"flex-start",spacing:"sm",grow:!0,children:[n.jsx(rr,{label:"Name",icon:n.jsx(Ve,{}),placeholder:"Enter name",maxLength:Ee,"data-autofocus":!0,...l.getInputProps("name")}),n.jsx(or,{label:"Value",icon:n.jsx(Ae,{}),placeholder:"Enter value",min:Oe,max:Pe,...l.getInputProps("value")})]}),n.jsx(M,{position:"right",children:n.jsx(Z,{variant:"filled",type:"submit",children:"Confirm"})})]})})})]});return y.useEffect(()=>{t&&l.reset()},[t]),n.jsxs($,{children:[n.jsxs($,{spacing:"xs",children:[n.jsxs(M,{position:"apart",children:[n.jsx(Be,{order:3,children:"Markers"}),(e==null?void 0:e.length)&&d]}),n.jsx(ye,{in:!!e,style:{minHeight:34},children:e!=null&&e.length?n.jsx(U.Group,{value:r.enabledMarkers,onChange:i=>a({enabledMarkers:i}),multiple:!0,children:n.jsx(He,{children:e==null?void 0:e.map(i=>n.jsx(jr,{activeGroup:o,marker:i},i.id))})}):d})]}),n.jsxs(M,{pt:6,children:[n.jsx(ne,{checked:r.enableLeftTicks,label:"Enable left ticks",onChange:({target:{checked:i}})=>a({enableLeftTicks:i})}),n.jsx(ne,{checked:r.enableLabels,label:"Enable labels",onChange:({target:{checked:i}})=>a({enableLabels:i})})]})]})}function F(){return(F=Object.assign||function(e){for(var o=1;o<arguments.length;o++){var r=arguments[o];for(var a in r)Object.prototype.hasOwnProperty.call(r,a)&&(e[a]=r[a])}return e}).apply(this,arguments)}var D,N;function q(e){var o=e.nativeEvent;return window.TouchEvent?o instanceof TouchEvent:"touches"in o}function X(e){return e.nativeEvent instanceof MouseEvent}function fe(e){return q(e)?{x:e.touches[0].pageX,y:e.touches[0].pageY}:X(e)?{x:e.pageX,y:e.pageY}:null}function kr(e,o){var r=o===void 0?{}:o,a=r.threshold,c=a===void 0?400:a,l=r.captureEvent,t=l!==void 0&&l,s=r.detect,d=s===void 0?N.BOTH:s,i=r.cancelOnMovement,h=i!==void 0&&i,C=r.filterEvents,u=r.onStart,v=r.onMove,x=r.onFinish,p=r.onCancel,S=y.useRef(!1),P=y.useRef(!1),E=y.useRef(),T=y.useRef(e),k=y.useRef(null),z=y.useCallback(function(f){return function(g){if(!P.current&&(X(g)||q(g))&&(C===void 0||C(g))){k.current=fe(g),t&&g.persist();var b=f===void 0?{}:{context:f};u==null||u(g,b),P.current=!0,E.current=setTimeout(function(){T.current&&(T.current(g,b),S.current=!0)},c)}}},[t,C,u,c]),j=y.useCallback(function(f,g){return function(b){if(X(b)||q(b)){k.current=null,t&&b.persist();var m=f===void 0?{}:{context:f};S.current?x==null||x(b,m):P.current&&(p==null||p(b,F({},m,{reason:g??D.CANCELED_BY_TIMEOUT}))),S.current=!1,P.current=!1,E.current!==void 0&&clearTimeout(E.current)}}},[t,x,p]),_=y.useCallback(function(f){return function(g){if(v==null||v(g,{context:f}),h&&k.current){var b=fe(g);if(b){var m=h===!0?25:h,R={x:Math.abs(b.x-k.current.x),y:Math.abs(b.y-k.current.y)};(R.x>m||R.y>m)&&j(f,D.CANCELED_BY_MOVEMENT)(g)}}}},[j,h,v]);return y.useEffect(function(){return function(){E.current!==void 0&&clearTimeout(E.current)}},[]),y.useEffect(function(){T.current=e},[e]),y.useMemo(function(){return function(f){var g={onMouseDown:z(f),onMouseMove:_(f),onMouseUp:j(f),onMouseLeave:j(f)},b={onTouchStart:z(f),onTouchMove:_(f),onTouchEnd:j(f)};return e===null?{}:d===N.MOUSE?g:d===N.TOUCH?b:F({},g,b)}},[e,j,d,_,z])}(function(e){e.CANCELED_BY_MOVEMENT="canceled-by-movement",e.CANCELED_BY_TIMEOUT="canceled-by-timeout"})(D||(D={})),function(e){e.BOTH="both",e.MOUSE="mouse",e.TOUCH="touch"}(N||(N={}));function jr({activeGroup:e,marker:o}){const r=J(),a=kr(()=>{e&&nr(e.id,o.id)},{threshold:500}),c={hidden:{opacity:0,scale:.98},visible:{opacity:1,scale:1}};return n.jsx(be,{label:"Long press to delete",openDelay:1e3,children:n.jsx(Y.div,{variants:c,initial:"hidden",animate:"visible",exit:"hidden",layout:!0,...a(),children:n.jsxs(U,{value:o.id,variant:"filled",radius:"md",styles:{root:{position:"relative"},input:{position:"absolute"},label:{display:"flex",gap:r.spacing.xs,padding:r.spacing.md,"&[data-checked]":{padding:r.spacing.md}},iconWrapper:{display:"flex",alignItems:"center",width:"fit-content"}},children:[n.jsx(xe,{size:12,color:o.color}),n.jsx(A,{size:"sm",color:"dimmed",inline:!0,children:o.name}),n.jsx(A,{size:"sm",weight:"bold",inline:!0,children:o.value})]})})})}function zr({activeGroup:e}){const[o,r]=De({key:"stock-group-filters",defaultValue:{enabledMarkers:[],enableLeftTicks:!1,enableLabels:!0},getInitialValueInEffect:!1}),a=u=>{r(v=>({...v,...u}))},c=e?ee(Ue(e.id),re("code","asc")):null,[l]=oe(c),t=e?ee(We(e.id),re("value","desc")):null,[s]=oe(t),d=o.enabledMarkers.map(u=>s==null?void 0:s.find(v=>v.id===u)).filter(u=>!!u),{data:i,keys:h}=y.useMemo(()=>{const u=[],v=[];return l&&u.push(l.reduce((x,p)=>(x[p.code]=p.quantity,x[`${p.code}Color`]=p.color?Je(p.color).toHexString():"",v.push(p.code),x),{})),{data:u,keys:v}},[l]),C=y.useMemo(()=>{const u=[];return l&&s&&d.forEach(({name:v,value:x})=>{u.push({text:l.filter(({quantity:p})=>p<x).length,sub:v})}),u.sort((v,x)=>x.text-v.text)},[o.enabledMarkers,l,s]);return n.jsxs($,{children:[n.jsx(ye,{in:!!l,style:{minHeight:336},children:n.jsxs($,{spacing:0,children:[n.jsx(qe,{items:[{text:l==null?void 0:l.length,sub:"Items"},...C]}),n.jsx(Ge,{in:!!(l!=null&&l.length),children:n.jsx(mr,{data:i,keys:h,markers:d,enableLeftTicks:o.enableLeftTicks,enableLabels:o.enableLabels})})]})}),n.jsx(Cr,{markers:s,activeGroup:e,filters:o,updateFilter:a})]})}export{zr as default};
