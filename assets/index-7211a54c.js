import{u as I,j as n,a8 as re,aQ as se,G as T,ay as G,T as O,g as ie,P,i as J,a4 as z,A as ae,E as Y,B as $,a6 as L,aK as le,aR as ce,r as p,q as ue,ac as de,t as he,v as F,w as q,X as fe,Y as xe,aA as pe}from"./index-48b3660d.js";import{L as Z,u as X}from"./useCollectionDataPersistent-aa628b92.js";import{z as me,O as ge}from"./nivo-legends.es-1315537e.js";import{t as be}from"./tinycolor-fc7bd882.js";import{M as ve,C as ee}from"./nivo-bar.es-1e9046c9.js";import{u as je,z as Me,q as ye,T as Ce,N as Ee,m as w,r as Te}from"./index-7f844d03.js";import{H as Le}from"./HueSlider-513109c2.js";import{C as Q}from"./Checkbox-0a5e1d3d.js";function Se({data:e,keys:t,markers:i,height:c=260,enableLeftTicks:m,enableLabels:r}){const o=I();return n.jsx(re,{pt:"md",sx:{height:c,width:"100%"},children:!!e.length&&n.jsx(ve,{data:e,keys:t,margin:{top:6,bottom:6,left:m?44:0},valueScale:{type:"linear"},indexScale:{type:"band"},axisLeft:{tickValues:3},axisBottom:null,groupMode:"grouped",defs:[me("gradient",[{offset:0,color:"inherit"},{offset:100,color:"inherit",opacity:o.colorScheme==="dark"?.25:.5}])],fill:[{match:"*",id:"gradient"}],theme:{textColor:o.colorScheme==="dark"?o.colors.dark[2]:o.colors.gray[6],fontSize:12,axis:{ticks:{line:{strokeWidth:m?2:0}}},crosshair:{line:{stroke:o.colorScheme==="dark"?o.colors.dark[1]:o.colors.gray[7]}}},tooltip:({id:s,value:u,data:a})=>n.jsx(se,{p:"sm",bg:o.colorScheme==="dark"?o.colors.dark[8]:o.colors.gray[1],shadow:o.shadows.md,children:n.jsxs(T,{spacing:"sm",children:[n.jsx(G,{size:14,color:`${a[`${s}Color`]}`}),n.jsx(O,{size:"sm",color:"dimmed",inline:!0,children:s}),n.jsx(O,{size:"sm",weight:"bold",inline:!0,children:u})]},s)}),markers:i.map(({color:s,value:u})=>({axis:"y",lineStyle:{stroke:s},value:u})),colors:({id:s,data:u})=>u[`${s}Color`]?`${u[`${s}Color`]}`:o.colorScheme==="dark"?o.colors.dark[5]:o.colors.gray[3],enableLabel:r,labelTextColor:({color:s})=>o.colorScheme==="dark"?o.fn.lighten(s,.25):o.fn.darken(s,.25),padding:m?.4/t.length:0,innerPadding:80/t.length,borderRadius:4,enableGridY:!1,motionConfig:"default"})})}const ne=10,te=1,oe=1e5,W=w.object({color:w.number(),name:w.string().trim().min(1,{message:"Required"}).max(ne),value:w.number({invalid_type_error:"Required"}).min(te).max(oe)});function ke({markers:e,activeGroup:t,filters:i,updateFilter:c}){const m=I(),r=je({initialValues:{color:0,name:""},validate:Me(W)}),[o,s]=ie(!1),u=n.jsxs(P,{width:360,position:e!=null&&e.length?"bottom-end":"bottom-start",trapFocus:!0,opened:o,onChange:s.toggle,children:[n.jsx(P.Target,{children:e!=null&&e.length?n.jsx(J,{label:"Add marker",children:n.jsx(z.div,{layoutId:"addMarkerButton",children:n.jsx(ae,{color:m.primaryColor,variant:"light",size:"md",onClick:s.toggle,children:n.jsx(Y,{})})})}):n.jsx(z.div,{layoutId:"addMarkerButton",style:{width:"fit-content"},children:n.jsx($,{variant:"light",leftIcon:n.jsx(Y,{}),h:34,onClick:s.toggle,children:"Add marker"})})}),n.jsx(P.Dropdown,{p:"md",children:n.jsx("form",{onSubmit:r.onSubmit(({color:a,...v})=>{t&&(s.close(),ye(t.id,{color:`hsl(${a}, 100%, 50%)`,...W.omit({color:!0}).parse(v)}))}),children:n.jsxs(L,{spacing:"sm",children:[n.jsx(Le,{value:r.values.color,onChange:a=>r.setFieldValue("color",a),onChangeEnd:a=>r.setFieldValue("color",a)}),n.jsxs(T,{align:"flex-start",spacing:"sm",grow:!0,children:[n.jsx(Ce,{label:"Name",icon:n.jsx(le,{}),placeholder:"Enter name",maxLength:ne,"data-autofocus":!0,...r.getInputProps("name")}),n.jsx(Ee,{label:"Value",icon:n.jsx(ce,{}),placeholder:"Enter value",min:te,max:oe,...r.getInputProps("value")})]}),n.jsx(T,{position:"right",children:n.jsx($,{variant:"filled",type:"submit",children:"Confirm"})})]})})})]});return p.useEffect(()=>{o&&r.reset()},[o]),n.jsxs(L,{children:[n.jsxs(L,{spacing:"xs",children:[n.jsxs(T,{position:"apart",children:[n.jsx(ue,{order:3,children:"Markers"}),(e==null?void 0:e.length)&&u]}),n.jsx(Z,{in:!!e,style:{minHeight:34},children:e!=null&&e.length?n.jsx(ee.Group,{value:i.enabledMarkers,onChange:a=>c({enabledMarkers:a}),multiple:!0,children:n.jsx(de,{children:e==null?void 0:e.map(a=>n.jsx(Oe,{activeGroup:t,marker:a},a.id))})}):u})]}),n.jsxs(T,{pt:6,children:[n.jsx(Q,{checked:i.enableLeftTicks,label:"Enable left ticks",onChange:({target:{checked:a}})=>c({enableLeftTicks:a})}),n.jsx(Q,{checked:i.enableLabels,label:"Enable labels",onChange:({target:{checked:a}})=>c({enableLabels:a})})]})]})}function H(){return(H=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var i=arguments[t];for(var c in i)Object.prototype.hasOwnProperty.call(i,c)&&(e[c]=i[c])}return e}).apply(this,arguments)}var A,S;function V(e){var t=e.nativeEvent;return window.TouchEvent?t instanceof TouchEvent:"touches"in t}function D(e){return e.nativeEvent instanceof MouseEvent}function K(e){return V(e)?{x:e.touches[0].pageX,y:e.touches[0].pageY}:D(e)?{x:e.pageX,y:e.pageY}:null}function we(e,t){var i=t===void 0?{}:t,c=i.threshold,m=c===void 0?400:c,r=i.captureEvent,o=r!==void 0&&r,s=i.detect,u=s===void 0?S.BOTH:s,a=i.cancelOnMovement,v=a!==void 0&&a,M=i.filterEvents,h=i.onStart,x=i.onMove,b=i.onFinish,g=i.onCancel,B=p.useRef(!1),k=p.useRef(!1),y=p.useRef(),_=p.useRef(e),C=p.useRef(null),R=p.useCallback(function(d){return function(l){if(!k.current&&(D(l)||V(l))&&(M===void 0||M(l))){C.current=K(l),o&&l.persist();var f=d===void 0?{}:{context:d};h==null||h(l,f),k.current=!0,y.current=setTimeout(function(){_.current&&(_.current(l,f),B.current=!0)},m)}}},[o,M,h,m]),j=p.useCallback(function(d,l){return function(f){if(D(f)||V(f)){C.current=null,o&&f.persist();var E=d===void 0?{}:{context:d};B.current?b==null||b(f,E):k.current&&(g==null||g(f,H({},E,{reason:l??A.CANCELED_BY_TIMEOUT}))),B.current=!1,k.current=!1,y.current!==void 0&&clearTimeout(y.current)}}},[o,b,g]),N=p.useCallback(function(d){return function(l){if(x==null||x(l,{context:d}),v&&C.current){var f=K(l);if(f){var E=v===!0?25:v,U={x:Math.abs(f.x-C.current.x),y:Math.abs(f.y-C.current.y)};(U.x>E||U.y>E)&&j(d,A.CANCELED_BY_MOVEMENT)(l)}}}},[j,v,x]);return p.useEffect(function(){return function(){y.current!==void 0&&clearTimeout(y.current)}},[]),p.useEffect(function(){_.current=e},[e]),p.useMemo(function(){return function(d){var l={onMouseDown:R(d),onMouseMove:N(d),onMouseUp:j(d),onMouseLeave:j(d)},f={onTouchStart:R(d),onTouchMove:N(d),onTouchEnd:j(d)};return e===null?{}:u===S.MOUSE?l:u===S.TOUCH?f:H({},l,f)}},[e,j,u,N,R])}(function(e){e.CANCELED_BY_MOVEMENT="canceled-by-movement",e.CANCELED_BY_TIMEOUT="canceled-by-timeout"})(A||(A={})),function(e){e.BOTH="both",e.MOUSE="mouse",e.TOUCH="touch"}(S||(S={}));function Oe({activeGroup:e,marker:t}){const i=I(),c=we(()=>{e&&Te(e.id,t.id)},{threshold:500}),m={hidden:{opacity:0,scale:.98},visible:{opacity:1,scale:1}};return n.jsx(J,{label:"Long press to delete",openDelay:1e3,children:n.jsx(z.div,{variants:m,initial:"hidden",animate:"visible",exit:"hidden",layout:!0,...c(),children:n.jsxs(ee,{value:t.id,variant:"filled",radius:"md",styles:{root:{position:"relative"},input:{position:"absolute"},label:{display:"flex",gap:i.spacing.xs,padding:i.spacing.md,"&[data-checked]":{padding:i.spacing.md}},iconWrapper:{display:"flex",alignItems:"center",width:"fit-content"}},children:[n.jsx(G,{size:12,color:t.color}),n.jsx(O,{size:"sm",color:"dimmed",inline:!0,children:t.name}),n.jsx(O,{size:"sm",weight:"bold",inline:!0,children:t.value})]})})})}function Ve({activeGroup:e}){const[t,i]=he({key:"stock-group-filters",defaultValue:{enabledMarkers:[],enableLeftTicks:!1,enableLabels:!0},getInitialValueInEffect:!1}),c=h=>{i(x=>({...x,...h}))},m=e?F(fe(e.id),q("code","asc")):null,[r]=X(m),o=e?F(xe(e.id),q("value","desc")):null,[s]=X(o),u=t.enabledMarkers.map(h=>s==null?void 0:s.find(x=>x.id===h)).filter(h=>!!h),{data:a,keys:v}=p.useMemo(()=>{const h=[],x=[];return r&&h.push(r.reduce((b,g)=>(b[g.code]=g.quantity,b[`${g.code}Color`]=g.color?be(g.color).toHexString():"",x.push(g.code),b),{})),{data:h,keys:x}},[r]),M=p.useMemo(()=>{const h=[];return r&&s&&u.forEach(({name:x,value:b})=>{h.push({text:r.filter(({quantity:g})=>g<b).length,sub:x})}),h.sort((x,b)=>b.text-x.text)},[t.enabledMarkers,r,s]);return n.jsxs(L,{children:[n.jsx(Z,{in:!!r,style:{minHeight:336},children:n.jsxs(L,{spacing:0,children:[n.jsx(ge,{items:[{text:r==null?void 0:r.length,sub:"Items"},...M]}),n.jsx(pe,{in:!!(r!=null&&r.length),children:n.jsx(Se,{data:a,keys:v,markers:u,enableLeftTicks:t.enableLeftTicks,enableLabels:t.enableLabels})})]})}),n.jsx(ke,{markers:s,activeGroup:e,filters:t,updateFilter:c})]})}export{Ve as default};
