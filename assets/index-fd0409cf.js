import{r as g,c as Se,u as Le,R,B as Ce,a as we,j as d,F as ie,b as t,G as b,d as U,T as x,e as Oe,f as Pe,g as Me,h as _e,i as De,k as ae,l as Te,m as Re,n as V,o as I,P as Y,p as M,q as k,A as $,s as le,t as Ie,v as ke,w as Ee,x as ze,y as Q,z as H,M as Ye,L as se,C as $e,O as Ae,D as G,E as X,H as Be,I as Fe,J as Ne,K as J,N as je,Q as A,S as We,U as Ve}from"./index-a850c355.js";import{u as oe,z as ce,e as _,N as de,m as D,d as He,a as Ue,b as ue}from"./index-5a84c722.js";import{S as qe,L as Qe}from"./ListManager-b130378c.js";import{u as K,L as Ge}from"./useCollectionDataPersistent-84d18d88.js";import{L as B}from"./LabeledSegmentedControl-6dde63de.js";import{M as Xe,d as y}from"./dayjs.min-14d2310a.js";function Je(e){const[n,r]=g.exports.useState(null),i=g.exports.useRef();return{ref:g.exports.useCallback(l=>{if(i.current&&(i.current.disconnect(),i.current=null),l===null){r(null);return}i.current=new IntersectionObserver(([s])=>{r(s)},e),i.current.observe(l)},[e==null?void 0:e.rootMargin,e==null?void 0:e.root,e==null?void 0:e.threshold]),entry:n}}var Ke=Object.defineProperty,Ze=Object.defineProperties,et=Object.getOwnPropertyDescriptors,Z=Object.getOwnPropertySymbols,tt=Object.prototype.hasOwnProperty,rt=Object.prototype.propertyIsEnumerable,ee=(e,n,r)=>n in e?Ke(e,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[n]=r,F=(e,n)=>{for(var r in n||(n={}))tt.call(n,r)&&ee(e,r,n[r]);if(Z)for(var r of Z(n))rt.call(n,r)&&ee(e,r,n[r]);return e},nt=(e,n)=>Ze(e,et(n));const N={xs:{fontSize:9,height:16},sm:{fontSize:10,height:18},md:{fontSize:11,height:20},lg:{fontSize:13,height:26},xl:{fontSize:16,height:32}},it={xs:4,sm:4,md:6,lg:8,xl:10};function at({theme:e,variant:n,color:r,size:i,gradient:a}){if(n==="dot"){const s=e.fn.size({size:i,sizes:it});return{backgroundColor:"transparent",color:e.colorScheme==="dark"?e.colors.dark[0]:e.colors.gray[7],border:`1px solid ${e.colorScheme==="dark"?e.colors.dark[3]:e.colors.gray[3]}`,paddingLeft:e.fn.size({size:i,sizes:e.spacing})/1.5-s/2,"&::before":{content:'""',display:"block",width:s,height:s,borderRadius:s,backgroundColor:e.fn.themeColor(r,e.colorScheme==="dark"?4:e.fn.primaryShade("light"),!0),marginRight:s}}}const l=e.fn.variant({color:r,variant:n,gradient:a});return{background:l.background,color:l.color,border:`${n==="gradient"?0:1}px solid ${l.border}`}}var lt=Se((e,{color:n,size:r,radius:i,gradient:a,fullWidth:l,variant:s})=>{const{fontSize:o,height:u}=r in N?N[r]:N.md;return{leftSection:{marginRight:`calc(${e.spacing.xs}px / 2)`},rightSection:{marginLeft:`calc(${e.spacing.xs}px / 2)`},inner:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},root:F(nt(F(F({},e.fn.focusStyles()),e.fn.fontStyles()),{fontSize:o,height:u,WebkitTapHighlightColor:"transparent",lineHeight:`${u-2}px`,textDecoration:"none",padding:`0 ${e.fn.size({size:r,sizes:e.spacing})/1.5}px`,boxSizing:"border-box",display:l?"flex":"inline-flex",alignItems:"center",justifyContent:"center",width:l?"100%":"auto",textTransform:"uppercase",borderRadius:e.fn.radius(i),fontWeight:700,letterSpacing:.25,cursor:"inherit",textOverflow:"ellipsis",overflow:"hidden"}),at({theme:e,variant:s,color:n,size:r,gradient:a}))}});const st=lt;var ot=Object.defineProperty,E=Object.getOwnPropertySymbols,pe=Object.prototype.hasOwnProperty,me=Object.prototype.propertyIsEnumerable,te=(e,n,r)=>n in e?ot(e,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[n]=r,ct=(e,n)=>{for(var r in n||(n={}))pe.call(n,r)&&te(e,r,n[r]);if(E)for(var r of E(n))me.call(n,r)&&te(e,r,n[r]);return e},dt=(e,n)=>{var r={};for(var i in e)pe.call(e,i)&&n.indexOf(i)<0&&(r[i]=e[i]);if(e!=null&&E)for(var i of E(e))n.indexOf(i)<0&&me.call(e,i)&&(r[i]=e[i]);return r};const ut={variant:"light",size:"md",radius:"xl"},fe=g.exports.forwardRef((e,n)=>{const r=Le("Badge",ut,e),{className:i,color:a,variant:l,fullWidth:s,children:o,size:u,leftSection:p,rightSection:h,radius:c,gradient:f,classNames:v,styles:m,unstyled:S}=r,w=dt(r,["className","color","variant","fullWidth","children","size","leftSection","rightSection","radius","gradient","classNames","styles","unstyled"]),{classes:L,cx:O}=st({size:u,fullWidth:s,color:a,radius:c,variant:l,gradient:f},{classNames:v,styles:m,name:"Badge",unstyled:S});return R.createElement(Ce,ct({className:O(L.root,i),ref:n},w),p&&R.createElement("span",{className:L.leftSection},p),R.createElement("span",{className:L.inner},o),h&&R.createElement("span",{className:L.rightSection},h))});fe.displayName="@mantine/core/Badge";const pt=we(fe);function mt({clients:e,filters:n,updateFilter:r}){return d(ie,{children:[t(B,{label:"Status",data:[{label:"All",value:"all"},{label:"Pending",value:"pending"},{label:"Finished",value:"finished"},{label:"Delivered",value:"delivered"}],value:n.status,onChange:i=>r({status:i})}),t(B,{label:"Order by",data:[{label:d(b,{spacing:"xs",position:"center",noWrap:!0,children:[t(U,{}),t(x,{children:"Price"})]}),value:"price"},{label:d(b,{spacing:"xs",position:"center",noWrap:!0,children:[t(Oe,{}),t(x,{children:"Received"})]}),value:"receivedTimestamp"},{label:d(b,{spacing:"xs",position:"center",noWrap:!0,children:[t(Pe,{}),t(x,{children:"Delivered"})]}),value:"deliveredTimestamp"}],value:n.orderBy,onChange:i=>r({orderBy:i})}),t(B,{label:"Direction",data:[{label:d(b,{spacing:"xs",position:"center",noWrap:!0,children:[t(Me,{}),t(x,{children:"Ascending"})]}),value:"asc"},{label:d(b,{spacing:"xs",position:"center",noWrap:!0,children:[t(_e,{}),t(x,{children:"Descending"})]}),value:"desc"}],value:n.direction,onChange:i=>r({direction:i})}),t(Xe,{label:"Filter by clients",data:(e==null?void 0:e.map(i=>({value:i.id,label:i.name})))??[],icon:t(De,{}),placeholder:"Select clients",nothingFound:"Client not found",maxLength:36,searchable:!0,value:n.clients,onChange:i=>r({clients:i})})]})}var he={exports:{}};(function(e,n){(function(r,i){e.exports=i()})(ae,function(){return function(r,i,a){var l="h:mm A",s={lastDay:"[Yesterday at] "+l,sameDay:"[Today at] "+l,nextDay:"[Tomorrow at] "+l,nextWeek:"dddd [at] "+l,lastWeek:"[Last] dddd [at] "+l,sameElse:"MM/DD/YYYY"};i.prototype.calendar=function(o,u){var p=u||this.$locale().calendar||s,h=a(o||void 0).startOf("d"),c=this.diff(h,"d",!0),f="sameElse",v=c<-6?f:c<-1?"lastWeek":c<0?"lastDay":c<1?"sameDay":c<2?"nextDay":c<7?"nextWeek":f,m=p[v]||s[v];return typeof m=="function"?m.call(this,a()):this.format(m)}}})})(he);const ft=he.exports;var ge={exports:{}};(function(e,n){(function(r,i){e.exports=i()})(ae,function(){var r={LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"};return function(i,a,l){var s=a.prototype,o=s.format;l.en.formats=r,s.format=function(u){u===void 0&&(u="YYYY-MM-DDTHH:mm:ssZ");var p=this.$locale().formats,h=function(c,f){return c.replace(/(\[[^\]]+])|(LTS?|l{1,4}|L{1,4})/g,function(v,m,S){var w=S&&S.toUpperCase();return m||f[S]||r[S]||f[w].replace(/(\[[^\]]+])|(MMMM|MM|DD|dddd)/g,function(L,O,z){return O||z.slice(1)})})}(u,p===void 0?{}:p);return o.call(this,h)}}})})(ge);const ht=ge.exports;y.extend(ft);y.extend(ht);const re={pending:{color:"yellow",icon:t(Ee,{})},finished:{color:"green",icon:t(le,{})},delivered:{color:"cyan",icon:t(ze,{})}},ve=1,ye=1e6,ne=D.object({price:D.number({invalid_type_error:"Required"}).min(ve).max(ye)});function gt({order:e,clientName:n,visibleNumbers:r,setFormValues:i,openOrderForm:a}){const l=Te(),s=Re({smallerThan:"sm"}),o=oe({initialValues:{},validate:ce(ne)}),[u,p]=V(!1),h={centered:!0,target:".modal-container"},c=()=>Q({title:t(H,{order:5,children:"Are you sure you want to mark this order as pending again?"}),children:t(x,{size:"sm",children:"The delivery date will be lost."}),labels:{confirm:"Confirm",cancel:"Cancel"},onConfirm:()=>_(e.id,{status:"pending",deliveredTimestamp:null}),...h}),f=()=>Q({title:t(H,{order:5,children:"Are you sure you want to delete this order?"}),labels:{confirm:"Delete",cancel:"Cancel"},onConfirm:()=>He(e.id),confirmProps:{color:"red"},...h}),v={hover:!0,focus:!0,touch:!0};return d(I.Row,{layoutId:e.id,children:[t("td",{children:d(Y,{position:"right",trapFocus:!0,opened:u,onChange:p.toggle,children:[t(Y.Target,{children:t(M,{label:`Set as ${e.status==="pending"?"finished":e.status==="finished"?"delivered":"pending"}`,openDelay:500,withinPortal:!0,children:t(k,{size:"xs",variant:"light",color:re[e.status].color,fullWidth:!0,onClick:()=>{switch(e.status){case"pending":{e.price?_(e.id,{status:"finished"}):(o.reset(),p.open());break}case"finished":{_(e.id,{status:"delivered",deliveredTimestamp:y().valueOf()});break}case"delivered":{c();break}}},children:s?re[e.status].icon:t(x,{transform:"capitalize",children:e.status})})})}),t(Y.Dropdown,{children:t("form",{onSubmit:o.onSubmit(m=>{p.close(),_(e.id,{status:"finished",...ne.parse(m)})}),children:d(b,{spacing:"sm",align:"flex-start",children:[t(de,{icon:t(U,{}),placeholder:"Enter price",min:ve,max:ye,...o.getInputProps("price")}),t($,{variant:"filled",color:l.primaryColor,my:1,type:"submit",children:t(le,{})})]})})})]})}),t("td",{children:n||t(x,{italic:!0,children:"Deleted"})}),t("td",{style:{textAlign:"right"},children:r?e.price?`$${e.price.toLocaleString()}`:t(pt,{p:0,color:"gray",sx:{backgroundColor:"transparent"},children:"Pending"}):"*****"}),t("td",{children:t(M,{label:y(e.receivedTimestamp).calendar(y(),{sameElse:"llll"}),events:v,openDelay:500,children:t(x,{sx:{cursor:"help"},children:y(e.receivedTimestamp).format("L")})})}),t("td",{children:t(M,{label:y(e.deliveredTimestamp).calendar(y(),{sameElse:"llll"}),events:v,openDelay:500,disabled:!e.deliveredTimestamp,children:t(x,{sx:{cursor:e.deliveredTimestamp?"help":"default"},children:e.deliveredTimestamp?y(e.deliveredTimestamp).format("L"):"-"})})}),t("td",{children:d(b,{position:"right",spacing:0,noWrap:!0,children:[t(M,{label:"Edit",children:t($,{color:l.primaryColor,onClick:()=>{i(e),a()},children:t(Ie,{})})}),t(M,{label:"Delete",children:t($,{color:"red",onClick:f,children:t(ke,{})})})]})})]})}const be=1e6,j=D.object({clientId:D.string({invalid_type_error:"Required"}).trim().min(1,{message:"Required"}),price:D.number().min(0).max(be).optional().default(0)});function vt({opened:e,closeForm:n,values:r,clients:i}){const a=oe({initialValues:{clientId:""},validate:ce(j)}),[l,s]=g.exports.useState(!1);return g.exports.useEffect(()=>{e&&(r?a.setValues({...r,price:r.price||void 0}):a.reset())},[e]),t(Ye,{opened:e,title:t(H,{order:5,children:r?"Edit order":"Add order"}),size:520,trapFocus:!0,onClose:n,target:".modal-container",children:d("form",{onSubmit:a.onSubmit(o=>{n(),r?_(r.id,j.parse(o)):Ue({...j.parse(o),status:"pending",receivedTimestamp:y().valueOf(),deliveredTimestamp:null})}),children:[d(b,{align:"flex-start",spacing:"sm",grow:!0,children:[t(qe,{label:"Client",data:(i==null?void 0:i.map(o=>({value:o.id,label:o.name})))??[],icon:l?t(se,{size:16}):t($e,{}),placeholder:l?"Loading client...":"Select client",nothingFound:"Client not found",initiallyOpened:!1,maxLength:36,creatable:!0,searchable:!0,selectOnBlur:!0,"data-autofocus":r?void 0:!0,disabled:l,getCreateLabel:o=>`+ Add client ${o}`,onCreate:async o=>{s(!0);const u=await ue({name:o}),p=await Ae(u);s(!1),a.setFieldValue("clientId",p.id)},...a.getInputProps("clientId")}),t(de,{label:"Price",icon:t(U,{}),placeholder:"Pending",min:0,max:be,"data-autofocus":!0,...a.getInputProps("price")})]}),t(b,{position:"right",mt:"md",children:t(k,{type:"submit",children:"Confirm"})})]})})}const W=20;function wt({visibleNumbers:e}){const n=G(Be,X("name","asc")),[r,i]=K(n),[a,l]=Fe({key:"order-filters",defaultValue:{status:"all",orderBy:"receivedTimestamp",direction:"desc",clients:[]},getInitialValueInEffect:!1}),s=C=>{l(T=>({...T,...C}))},[o,u]=g.exports.useState(W),p=[X(a.orderBy,a.direction),Ne(o)];a.status!=="all"&&p.push(J("status","==",a.status)),a.clients.length&&p.push(J("clientId","in",a.clients));const h=G(je,...p),[c,f]=K(h),[v,m]=V(!1),[S,w]=V(!1),[L,O]=g.exports.useState(),z=g.exports.useRef(),{ref:q,entry:P}=Je({root:z.current,threshold:.5});return g.exports.useEffect(()=>{u(W),s({orderBy:["all","pending","finished"].includes(a.status)?"receivedTimestamp":"deliveredTimestamp",direction:"desc"})},[a.status]),g.exports.useEffect(()=>{(P==null?void 0:P.isIntersecting)&&!f&&u(C=>C+W)},[P==null?void 0:P.isIntersecting]),d(A,{children:[t(A.Header,{title:"Orders",loading:i||f,buttons:d(ie,{children:[t(k,{leftIcon:t(We,{}),onClick:()=>{O(void 0),m.open()},children:"New order"}),t(k,{variant:"light",leftIcon:t(Ve,{}),onClick:w.open,children:"Manage clients"})]}),filters:t(mt,{clients:r,filters:a,updateFilter:s}),withNumbersToggle:!0}),d(A.Body,{ref:q,children:[t(vt,{opened:v,closeForm:m.close,values:L,clients:r}),t(Qe,{opened:S,close:w.close,label:"client",items:r,addItem:ue}),d(Ge,{in:!!(r&&c),children:[d(I,{children:[d(I.Header,{children:[t("th",{style:{width:0},children:"Status"}),t("th",{children:"Client"}),t("th",{style:{width:0,textAlign:"right"},children:"Price"}),t("th",{style:{width:0,textAlign:"center"},children:"Received"}),t("th",{style:{width:0,textAlign:"center"},children:"Delivered"}),t("th",{style:{width:0}})]}),t(I.Body,{children:c==null?void 0:c.map(C=>{var T;return t(gt,{order:C,clientName:(T=r==null?void 0:r.find(xe=>xe.id===C.clientId))==null?void 0:T.name,visibleNumbers:e,setFormValues:O,openOrderForm:m.open},C.id)})})]}),(c==null?void 0:c.length)===o&&t(b,{ref:q,pt:"xs",pb:"lg",position:"center",children:t(se,{})})]})]})]})}export{wt as default};
