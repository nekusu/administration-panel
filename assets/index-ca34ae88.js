import{r as g,c as Se,u as Le,R,B as Ce,a as we,j as d,F as ne,b as t,G as b,d as ie,T as x,e as Oe,f as Pe,g as Me,h as _e,i as De,k as ae,l as Te,m as Re,n as V,o as I,P as z,p as M,q as $,A as Y,s as se,t as Ie,v as $e,w as ke,x as Ee,y as q,z as H,M as ze,L as le,C as Ye,O as Ae,D as Q,E as G,H as Ne,I as Be,J as Fe,K as X,N as je,Q as A,S as We,U as Ve}from"./index-7a329043.js";import{u as oe,z as ce,e as _,N as de,m as D,d as He,a as Ue,b as ue}from"./index-89186db0.js";import{S as qe,L as Qe}from"./ListManager-e6a969dc.js";import{u as J,L as Ge}from"./useCollectionDataPersistent-94b1f33f.js";import{L as N}from"./LabeledSegmentedControl-921a81ce.js";import{M as Xe,d as y}from"./dayjs.min-df6a25b0.js";function Je(e){const[n,r]=g.exports.useState(null),i=g.exports.useRef();return{ref:g.exports.useCallback(l=>{if(i.current&&(i.current.disconnect(),i.current=null),l===null){r(null);return}i.current=new IntersectionObserver(([o])=>{r(o)},e),i.current.observe(l)},[e==null?void 0:e.rootMargin,e==null?void 0:e.root,e==null?void 0:e.threshold]),entry:n}}var Ke=Object.defineProperty,Ze=Object.defineProperties,et=Object.getOwnPropertyDescriptors,K=Object.getOwnPropertySymbols,tt=Object.prototype.hasOwnProperty,rt=Object.prototype.propertyIsEnumerable,Z=(e,n,r)=>n in e?Ke(e,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[n]=r,B=(e,n)=>{for(var r in n||(n={}))tt.call(n,r)&&Z(e,r,n[r]);if(K)for(var r of K(n))rt.call(n,r)&&Z(e,r,n[r]);return e},nt=(e,n)=>Ze(e,et(n));const F={xs:{fontSize:9,height:16},sm:{fontSize:10,height:18},md:{fontSize:11,height:20},lg:{fontSize:13,height:26},xl:{fontSize:16,height:32}},it={xs:4,sm:4,md:6,lg:8,xl:10};function at({theme:e,variant:n,color:r,size:i,gradient:s}){if(n==="dot"){const o=e.fn.size({size:i,sizes:it});return{backgroundColor:"transparent",color:e.colorScheme==="dark"?e.colors.dark[0]:e.colors.gray[7],border:`1px solid ${e.colorScheme==="dark"?e.colors.dark[3]:e.colors.gray[3]}`,paddingLeft:e.fn.size({size:i,sizes:e.spacing})/1.5-o/2,"&::before":{content:'""',display:"block",width:o,height:o,borderRadius:o,backgroundColor:e.fn.themeColor(r,e.colorScheme==="dark"?4:e.fn.primaryShade("light"),!0),marginRight:o}}}const l=e.fn.variant({color:r,variant:n,gradient:s});return{background:l.background,color:l.color,border:`${n==="gradient"?0:1}px solid ${l.border}`}}var st=Se((e,{color:n,size:r,radius:i,gradient:s,fullWidth:l,variant:o})=>{const{fontSize:a,height:u}=r in F?F[r]:F.md;return{leftSection:{marginRight:`calc(${e.spacing.xs}px / 2)`},rightSection:{marginLeft:`calc(${e.spacing.xs}px / 2)`},inner:{whiteSpace:"nowrap",overflow:"hidden",textOverflow:"ellipsis"},root:B(nt(B(B({},e.fn.focusStyles()),e.fn.fontStyles()),{fontSize:a,height:u,WebkitTapHighlightColor:"transparent",lineHeight:`${u-2}px`,textDecoration:"none",padding:`0 ${e.fn.size({size:r,sizes:e.spacing})/1.5}px`,boxSizing:"border-box",display:l?"flex":"inline-flex",alignItems:"center",justifyContent:"center",width:l?"100%":"auto",textTransform:"uppercase",borderRadius:e.fn.radius(i),fontWeight:700,letterSpacing:.25,cursor:"inherit",textOverflow:"ellipsis",overflow:"hidden"}),at({theme:e,variant:o,color:n,size:r,gradient:s}))}});const lt=st;var ot=Object.defineProperty,k=Object.getOwnPropertySymbols,pe=Object.prototype.hasOwnProperty,me=Object.prototype.propertyIsEnumerable,ee=(e,n,r)=>n in e?ot(e,n,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[n]=r,ct=(e,n)=>{for(var r in n||(n={}))pe.call(n,r)&&ee(e,r,n[r]);if(k)for(var r of k(n))me.call(n,r)&&ee(e,r,n[r]);return e},dt=(e,n)=>{var r={};for(var i in e)pe.call(e,i)&&n.indexOf(i)<0&&(r[i]=e[i]);if(e!=null&&k)for(var i of k(e))n.indexOf(i)<0&&me.call(e,i)&&(r[i]=e[i]);return r};const ut={variant:"light",size:"md",radius:"xl"},fe=g.exports.forwardRef((e,n)=>{const r=Le("Badge",ut,e),{className:i,color:s,variant:l,fullWidth:o,children:a,size:u,leftSection:p,rightSection:h,radius:c,gradient:f,classNames:v,styles:m,unstyled:S}=r,w=dt(r,["className","color","variant","fullWidth","children","size","leftSection","rightSection","radius","gradient","classNames","styles","unstyled"]),{classes:L,cx:O}=lt({size:u,fullWidth:o,color:s,radius:c,variant:l,gradient:f},{classNames:v,styles:m,name:"Badge",unstyled:S});return R.createElement(Ce,ct({className:O(L.root,i),ref:n},w),p&&R.createElement("span",{className:L.leftSection},p),R.createElement("span",{className:L.inner},a),h&&R.createElement("span",{className:L.rightSection},h))});fe.displayName="@mantine/core/Badge";const pt=we(fe);function mt({clients:e,filters:n,updateFilter:r}){return d(ne,{children:[t(N,{label:"Status",data:[{label:"All",value:"all"},{label:"Pending",value:"pending"},{label:"Finished",value:"finished"},{label:"Delivered",value:"delivered"}],value:n.status,onChange:i=>r({status:i})}),t(N,{label:"Order by",data:[{label:d(b,{spacing:"xs",position:"center",noWrap:!0,children:[t(ie,{}),t(x,{children:"Price"})]}),value:"price"},{label:d(b,{spacing:"xs",position:"center",noWrap:!0,children:[t(Oe,{}),t(x,{children:"Received"})]}),value:"receivedTimestamp"},{label:d(b,{spacing:"xs",position:"center",noWrap:!0,children:[t(Pe,{}),t(x,{children:"Delivered"})]}),value:"deliveredTimestamp"}],value:n.orderBy,onChange:i=>r({orderBy:i})}),t(N,{label:"Direction",data:[{label:d(b,{spacing:"xs",position:"center",noWrap:!0,children:[t(Me,{}),t(x,{children:"Ascending"})]}),value:"asc"},{label:d(b,{spacing:"xs",position:"center",noWrap:!0,children:[t(_e,{}),t(x,{children:"Descending"})]}),value:"desc"}],value:n.direction,onChange:i=>r({direction:i})}),t(Xe,{label:"Filter by clients",data:(e==null?void 0:e.map(i=>({value:i.id,label:i.name})))??[],icon:t(De,{}),placeholder:"Select clients",nothingFound:"Client not found",maxLength:36,searchable:!0,value:n.clients,onChange:i=>r({clients:i})})]})}var he={exports:{}};(function(e,n){(function(r,i){e.exports=i()})(ae,function(){return function(r,i,s){var l="h:mm A",o={lastDay:"[Yesterday at] "+l,sameDay:"[Today at] "+l,nextDay:"[Tomorrow at] "+l,nextWeek:"dddd [at] "+l,lastWeek:"[Last] dddd [at] "+l,sameElse:"MM/DD/YYYY"};i.prototype.calendar=function(a,u){var p=u||this.$locale().calendar||o,h=s(a||void 0).startOf("d"),c=this.diff(h,"d",!0),f="sameElse",v=c<-6?f:c<-1?"lastWeek":c<0?"lastDay":c<1?"sameDay":c<2?"nextDay":c<7?"nextWeek":f,m=p[v]||o[v];return typeof m=="function"?m.call(this,s()):this.format(m)}}})})(he);const ft=he.exports;var ge={exports:{}};(function(e,n){(function(r,i){e.exports=i()})(ae,function(){var r={LTS:"h:mm:ss A",LT:"h:mm A",L:"MM/DD/YYYY",LL:"MMMM D, YYYY",LLL:"MMMM D, YYYY h:mm A",LLLL:"dddd, MMMM D, YYYY h:mm A"};return function(i,s,l){var o=s.prototype,a=o.format;l.en.formats=r,o.format=function(u){u===void 0&&(u="YYYY-MM-DDTHH:mm:ssZ");var p=this.$locale().formats,h=function(c,f){return c.replace(/(\[[^\]]+])|(LTS?|l{1,4}|L{1,4})/g,function(v,m,S){var w=S&&S.toUpperCase();return m||f[S]||r[S]||f[w].replace(/(\[[^\]]+])|(MMMM|MM|DD|dddd)/g,function(L,O,E){return O||E.slice(1)})})}(u,p===void 0?{}:p);return a.call(this,h)}}})})(ge);const ht=ge.exports;y.extend(ft);y.extend(ht);const te={pending:{color:"yellow",icon:t(ke,{})},finished:{color:"green",icon:t(se,{})},delivered:{color:"cyan",icon:t(Ee,{})}},ve=1,ye=1e6,re=D.object({price:D.number({invalid_type_error:"Required"}).min(ve).max(ye)});function gt({order:e,clientName:n,visibleNumbers:r,setFormValues:i,openOrderForm:s}){const l=Te(),o=Re({smallerThan:"sm"}),a=oe({initialValues:{},validate:ce(re)}),[u,p]=V(!1),h={centered:!0,target:".modal-container"},c=()=>q({title:t(H,{order:5,children:"Are you sure you want to mark this order as pending again?"}),children:t(x,{size:"sm",children:"The delivery date will be lost."}),labels:{confirm:"Confirm",cancel:"Cancel"},onConfirm:()=>_(e.id,{status:"pending",deliveredTimestamp:null}),...h}),f=()=>q({title:t(H,{order:5,children:"Are you sure you want to delete this order?"}),labels:{confirm:"Delete",cancel:"Cancel"},onConfirm:()=>He(e.id),confirmProps:{color:"red"},...h}),v={hover:!0,focus:!0,touch:!0};return d(I.Row,{layoutId:e.id,children:[t("td",{children:d(z,{position:"right",trapFocus:!0,opened:u,onChange:p.toggle,children:[t(z.Target,{children:t(M,{label:`Set as ${e.status==="pending"?"finished":e.status==="finished"?"delivered":"pending"}`,openDelay:500,withinPortal:!0,children:t($,{size:"xs",variant:"light",color:te[e.status].color,fullWidth:!0,onClick:()=>{switch(e.status){case"pending":{e.price?_(e.id,{status:"finished"}):(a.reset(),p.open());break}case"finished":{_(e.id,{status:"delivered",deliveredTimestamp:y().valueOf()});break}case"delivered":{c();break}}},children:o?te[e.status].icon:t(x,{transform:"capitalize",children:e.status})})})}),t(z.Dropdown,{children:t("form",{onSubmit:a.onSubmit(m=>{p.close(),_(e.id,{status:"finished",...re.parse(m)})}),children:d(b,{spacing:"sm",align:"flex-start",children:[t(de,{icon:t(ie,{}),placeholder:"Enter price",min:ve,max:ye,...a.getInputProps("price")}),t(Y,{variant:"filled",color:l.primaryColor,my:1,type:"submit",children:t(se,{})})]})})})]})}),t("td",{children:n||t(x,{italic:!0,children:"Deleted"})}),t("td",{style:{textAlign:"right"},children:r?e.price?`$${e.price.toLocaleString()}`:t(pt,{p:0,color:"gray",sx:{backgroundColor:"transparent"},children:"Pending"}):"*****"}),t("td",{children:t(M,{label:y(e.receivedTimestamp).calendar(y(),{sameElse:"llll"}),events:v,openDelay:500,children:t(x,{sx:{cursor:"help"},children:y(e.receivedTimestamp).format("L")})})}),t("td",{children:t(M,{label:y(e.deliveredTimestamp).calendar(y(),{sameElse:"llll"}),events:v,openDelay:500,disabled:!e.deliveredTimestamp,children:t(x,{sx:{cursor:e.deliveredTimestamp?"help":"default"},children:e.deliveredTimestamp?y(e.deliveredTimestamp).format("L"):"-"})})}),t("td",{children:d(b,{position:"right",spacing:0,noWrap:!0,children:[t(M,{label:"Edit",children:t(Y,{color:l.primaryColor,onClick:()=>{i(e),s()},children:t(Ie,{})})}),t(M,{label:"Delete",children:t(Y,{color:"red",onClick:f,children:t($e,{})})})]})})]})}const be=1e6,j=D.object({clientId:D.string({invalid_type_error:"Required"}).trim().min(1,{message:"Required"}),price:D.number().min(0).max(be).optional().default(0)});function vt({opened:e,closeForm:n,values:r,clients:i}){const s=oe({initialValues:{clientId:""},validate:ce(j)}),[l,o]=g.exports.useState(!1);return g.exports.useEffect(()=>{e&&(r?s.setValues({...r,price:r.price||void 0}):s.reset())},[e]),t(ze,{opened:e,title:t(H,{order:5,children:r?"Edit order":"Add order"}),size:520,trapFocus:!0,onClose:n,target:".modal-container",children:d("form",{onSubmit:s.onSubmit(a=>{n(),r?_(r.id,j.parse(a)):Ue({...j.parse(a),status:"pending",receivedTimestamp:y().valueOf(),deliveredTimestamp:null})}),children:[d(b,{align:"flex-start",spacing:"sm",grow:!0,children:[t(qe,{label:"Client",data:(i==null?void 0:i.map(a=>({value:a.id,label:a.name})))??[],icon:l?t(le,{size:16}):t(Ye,{}),placeholder:l?"Loading client...":"Select client",nothingFound:"Client not found",initiallyOpened:!1,maxLength:36,creatable:!0,searchable:!0,selectOnBlur:!0,"data-autofocus":r?void 0:!0,disabled:l,getCreateLabel:a=>`+ Add client ${a}`,onCreate:async a=>{o(!0);const u=await ue({name:a}),p=await Ae(u);o(!1),s.setFieldValue("clientId",p.id)},...s.getInputProps("clientId")}),t(de,{label:"Price",parser:a=>a==null?void 0:a.replace(/\$\s?|(,*)/g,""),formatter:a=>Number.isNaN(+a)?"$ ":`$ ${a}`.replace(/\B(?=(\d{3})+(?!\d))/g,","),placeholder:"Pending",min:0,max:be,precision:2,"data-autofocus":!0,...s.getInputProps("price")})]}),t(b,{position:"right",mt:"md",children:t($,{type:"submit",children:"Confirm"})})]})})}const W=20;function wt({visibleNumbers:e}){const n=Q(Ne,G("name","asc")),[r,i]=J(n),[s,l]=Be({key:"order-filters",defaultValue:{status:"all",orderBy:"receivedTimestamp",direction:"desc",clients:[]},getInitialValueInEffect:!1}),o=C=>{l(T=>({...T,...C}))},[a,u]=g.exports.useState(W),p=[G(s.orderBy,s.direction),Fe(a)];s.status!=="all"&&p.push(X("status","==",s.status)),s.clients.length&&p.push(X("clientId","in",s.clients));const h=Q(je,...p),[c,f]=J(h),[v,m]=V(!1),[S,w]=V(!1),[L,O]=g.exports.useState(),E=g.exports.useRef(),{ref:U,entry:P}=Je({root:E.current,threshold:.5});return g.exports.useEffect(()=>{u(W),o({orderBy:["all","pending","finished"].includes(s.status)?"receivedTimestamp":"deliveredTimestamp",direction:"desc"})},[s.status]),g.exports.useEffect(()=>{(P==null?void 0:P.isIntersecting)&&!f&&u(C=>C+W)},[P==null?void 0:P.isIntersecting]),d(A,{children:[t(A.Header,{title:"Orders",loading:i||f,buttons:d(ne,{children:[t($,{leftIcon:t(We,{}),onClick:()=>{O(void 0),m.open()},children:"New order"}),t($,{variant:"light",leftIcon:t(Ve,{}),onClick:w.open,children:"Manage clients"})]}),filters:t(mt,{clients:r,filters:s,updateFilter:o}),withNumbersToggle:!0}),d(A.Body,{ref:U,children:[t(vt,{opened:v,closeForm:m.close,values:L,clients:r}),t(Qe,{opened:S,close:w.close,label:"client",items:r,addItem:ue}),d(Ge,{in:!!(r&&c),children:[d(I,{children:[d(I.Header,{children:[t("th",{style:{width:0},children:"Status"}),t("th",{children:"Client"}),t("th",{style:{width:0,textAlign:"right"},children:"Price"}),t("th",{style:{width:0,textAlign:"center"},children:"Received"}),t("th",{style:{width:0,textAlign:"center"},children:"Delivered"}),t("th",{style:{width:0}})]}),t(I.Body,{children:c==null?void 0:c.map(C=>{var T;return t(gt,{order:C,clientName:(T=r==null?void 0:r.find(xe=>xe.id===C.clientId))==null?void 0:T.name,visibleNumbers:e,setFormValues:O,openOrderForm:m.open},C.id)})})]}),(c==null?void 0:c.length)===a&&t(b,{ref:U,pt:"xs",pb:"lg",position:"center",children:t(le,{})})]})]})]})}export{wt as default};
